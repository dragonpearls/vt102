<!doctype html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />

    <title>vt102 API documentation</title>
    <meta name="description" content="[vt102](http://github.com/samfoo/vt102) is an in memory vt1xx terminal
emulator. It supports all the..." />

  <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300' rel='stylesheet' type='text/css'>
  
  <style type="text/css">
  
* {
  box-sizing: border-box;
}
/*! normalize.css v1.1.1 | MIT License | git.io/normalize */

/* ==========================================================================
   HTML5 display definitions
   ========================================================================== */

/**
 * Correct `block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

article,
aside,
details,
figcaption,
figure,
footer,
header,
hgroup,
main,
nav,
section,
summary {
    display: block;
}

/**
 * Correct `inline-block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

audio,
canvas,
video {
    display: inline-block;
    *display: inline;
    *zoom: 1;
}

/**
 * Prevent modern browsers from displaying `audio` without controls.
 * Remove excess height in iOS 5 devices.
 */

audio:not([controls]) {
    display: none;
    height: 0;
}

/**
 * Address styling not present in IE 7/8/9, Firefox 3, and Safari 4.
 * Known issue: no IE 6 support.
 */

[hidden] {
    display: none;
}

/* ==========================================================================
   Base
   ========================================================================== */

/**
 * 1. Prevent system color scheme's background color being used in Firefox, IE,
 *    and Opera.
 * 2. Prevent system color scheme's text color being used in Firefox, IE, and
 *    Opera.
 * 3. Correct text resizing oddly in IE 6/7 when body `font-size` is set using
 *    `em` units.
 * 4. Prevent iOS text size adjust after orientation change, without disabling
 *    user zoom.
 */

html {
    background: #fff; /* 1 */
    color: #000; /* 2 */
    font-size: 100%; /* 3 */
    -webkit-text-size-adjust: 100%; /* 4 */
    -ms-text-size-adjust: 100%; /* 4 */
}

/**
 * Address `font-family` inconsistency between `textarea` and other form
 * elements.
 */

html,
button,
input,
select,
textarea {
    font-family: sans-serif;
}

/**
 * Address margins handled incorrectly in IE 6/7.
 */

body {
    margin: 0;
}

/* ==========================================================================
   Links
   ========================================================================== */

/**
 * Address `outline` inconsistency between Chrome and other browsers.
 */

a:focus {
    outline: thin dotted;
}

/**
 * Improve readability when focused and also mouse hovered in all browsers.
 */

a:active,
a:hover {
    outline: 0;
}

/* ==========================================================================
   Typography
   ========================================================================== */

/**
 * Address font sizes and margins set differently in IE 6/7.
 * Address font sizes within `section` and `article` in Firefox 4+, Safari 5,
 * and Chrome.
 */

h1 {
    font-size: 2em;
    margin: 0.67em 0;
}

h2 {
    font-size: 1.5em;
    margin: 0.83em 0;
}

h3 {
    font-size: 1.17em;
    margin: 1em 0;
}

h4 {
    font-size: 1em;
    margin: 1.33em 0;
}

h5 {
    font-size: 0.83em;
    margin: 1.67em 0;
}

h6 {
    font-size: 0.67em;
    margin: 2.33em 0;
}

/**
 * Address styling not present in IE 7/8/9, Safari 5, and Chrome.
 */

abbr[title] {
    border-bottom: 1px dotted;
}

/**
 * Address style set to `bolder` in Firefox 3+, Safari 4/5, and Chrome.
 */

b,
strong {
    font-weight: bold;
}

blockquote {
    margin: 1em 40px;
}

/**
 * Address styling not present in Safari 5 and Chrome.
 */

dfn {
    font-style: italic;
}

/**
 * Address differences between Firefox and other browsers.
 * Known issue: no IE 6/7 normalization.
 */

hr {
    -moz-box-sizing: content-box;
    box-sizing: content-box;
    height: 0;
}

/**
 * Address styling not present in IE 6/7/8/9.
 */

mark {
    background: #ff0;
    color: #000;
}

/**
 * Address margins set differently in IE 6/7.
 */

p,
pre {
    margin: 1em 0;
}

/**
 * Correct font family set oddly in IE 6, Safari 4/5, and Chrome.
 */

code,
kbd,
pre,
samp {
    font-family: monospace, serif;
    _font-family: 'courier new', monospace;
    font-size: 1em;
}

/**
 * Improve readability of pre-formatted text in all browsers.
 */

pre {
    white-space: pre;
    white-space: pre-wrap;
    word-wrap: break-word;
}

/**
 * Address CSS quotes not supported in IE 6/7.
 */

q {
    quotes: none;
}

/**
 * Address `quotes` property not supported in Safari 4.
 */

q:before,
q:after {
    content: '';
    content: none;
}

/**
 * Address inconsistent and variable font size in all browsers.
 */

small {
    font-size: 80%;
}

/**
 * Prevent `sub` and `sup` affecting `line-height` in all browsers.
 */

sub,
sup {
    font-size: 75%;
    line-height: 0;
    position: relative;
    vertical-align: baseline;
}

sup {
    top: -0.5em;
}

sub {
    bottom: -0.25em;
}

/* ==========================================================================
   Lists
   ========================================================================== */

/**
 * Address margins set differently in IE 6/7.
 */

dl,
menu,
ol,
ul {
    margin: 1em 0;
}

dd {
    margin: 0 0 0 40px;
}

/**
 * Address paddings set differently in IE 6/7.
 */

menu,
ol,
ul {
    padding: 0 0 0 40px;
}

/**
 * Correct list images handled incorrectly in IE 7.
 */

nav ul,
nav ol {
    list-style: none;
    list-style-image: none;
}

/* ==========================================================================
   Embedded content
   ========================================================================== */

/**
 * 1. Remove border when inside `a` element in IE 6/7/8/9 and Firefox 3.
 * 2. Improve image quality when scaled in IE 7.
 */

img {
    border: 0; /* 1 */
    -ms-interpolation-mode: bicubic; /* 2 */
}

/**
 * Correct overflow displayed oddly in IE 9.
 */

svg:not(:root) {
    overflow: hidden;
}

/* ==========================================================================
   Figures
   ========================================================================== */

/**
 * Address margin not present in IE 6/7/8/9, Safari 5, and Opera 11.
 */

figure {
    margin: 0;
}

/* ==========================================================================
   Forms
   ========================================================================== */

/**
 * Correct margin displayed oddly in IE 6/7.
 */

form {
    margin: 0;
}

/**
 * Define consistent border, margin, and padding.
 */

fieldset {
    border: 1px solid #c0c0c0;
    margin: 0 2px;
    padding: 0.35em 0.625em 0.75em;
}

/**
 * 1. Correct color not being inherited in IE 6/7/8/9.
 * 2. Correct text not wrapping in Firefox 3.
 * 3. Correct alignment displayed oddly in IE 6/7.
 */

legend {
    border: 0; /* 1 */
    padding: 0;
    white-space: normal; /* 2 */
    *margin-left: -7px; /* 3 */
}

/**
 * 1. Correct font size not being inherited in all browsers.
 * 2. Address margins set differently in IE 6/7, Firefox 3+, Safari 5,
 *    and Chrome.
 * 3. Improve appearance and consistency in all browsers.
 */

button,
input,
select,
textarea {
    font-size: 100%; /* 1 */
    margin: 0; /* 2 */
    vertical-align: baseline; /* 3 */
    *vertical-align: middle; /* 3 */
}

/**
 * Address Firefox 3+ setting `line-height` on `input` using `!important` in
 * the UA stylesheet.
 */

button,
input {
    line-height: normal;
}

/**
 * Address inconsistent `text-transform` inheritance for `button` and `select`.
 * All other form control elements do not inherit `text-transform` values.
 * Correct `button` style inheritance in Chrome, Safari 5+, and IE 6+.
 * Correct `select` style inheritance in Firefox 4+ and Opera.
 */

button,
select {
    text-transform: none;
}

/**
 * 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio`
 *    and `video` controls.
 * 2. Correct inability to style clickable `input` types in iOS.
 * 3. Improve usability and consistency of cursor style between image-type
 *    `input` and others.
 * 4. Remove inner spacing in IE 7 without affecting normal text inputs.
 *    Known issue: inner spacing remains in IE 6.
 */

button,
html input[type="button"], /* 1 */
input[type="reset"],
input[type="submit"] {
    -webkit-appearance: button; /* 2 */
    cursor: pointer; /* 3 */
    *overflow: visible;  /* 4 */
}

/**
 * Re-set default cursor for disabled elements.
 */

button[disabled],
html input[disabled] {
    cursor: default;
}

/**
 * 1. Address box sizing set to content-box in IE 8/9.
 * 2. Remove excess padding in IE 8/9.
 * 3. Remove excess padding in IE 7.
 *    Known issue: excess padding remains in IE 6.
 */

input[type="checkbox"],
input[type="radio"] {
    box-sizing: border-box; /* 1 */
    padding: 0; /* 2 */
    *height: 13px; /* 3 */
    *width: 13px; /* 3 */
}

/**
 * 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome.
 * 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome
 *    (include `-moz` to future-proof).
 */

input[type="search"] {
    -webkit-appearance: textfield; /* 1 */
    -moz-box-sizing: content-box;
    -webkit-box-sizing: content-box; /* 2 */
    box-sizing: content-box;
}

/**
 * Remove inner padding and search cancel button in Safari 5 and Chrome
 * on OS X.
 */

input[type="search"]::-webkit-search-cancel-button,
input[type="search"]::-webkit-search-decoration {
    -webkit-appearance: none;
}

/**
 * Remove inner padding and border in Firefox 3+.
 */

button::-moz-focus-inner,
input::-moz-focus-inner {
    border: 0;
    padding: 0;
}

/**
 * 1. Remove default vertical scrollbar in IE 6/7/8/9.
 * 2. Improve readability and alignment in all browsers.
 */

textarea {
    overflow: auto; /* 1 */
    vertical-align: top; /* 2 */
}

/* ==========================================================================
   Tables
   ========================================================================== */

/**
 * Remove most spacing between table cells.
 */

table {
    border-collapse: collapse;
    border-spacing: 0;
}

  </style>

  <style type="text/css">
  
  html, body {
    margin: 0;
    padding: 0;
    height: 100%;
  }
  body {
    background: #fff;
    font-family: "Source Sans Pro", "Helvetica Neueue", Helvetica, sans;
    font-weight: 300;
    font-size: 16px;
    line-height: 1.6em;
  }
  #content {
    width: 70%;
    max-width: 850px;
    float: left;
    padding: 30px 60px;
    border-left: 1px solid #ddd;
  }
  #sidebar {
    width: 25%;
    float: left;
    padding: 30px;
    overflow: hidden;
  }
  #nav {
    font-size: 130%;
    margin: 0 0 15px 0;
  }

  #top {
    display: block;
    position: fixed;
    bottom: 5px;
    left: 5px;
    font-size: .85em;
    text-transform: uppercase;
  }

  #footer {
    font-size: .75em;
    padding: 5px 30px;
    border-top: 1px solid #ddd;
    text-align: right;
  }
    #footer p {
      margin: 0 0 0 30px;
      display: inline-block;
    }

  h1, h2, h3, h4, h5 {
    font-weight: 300;
  }
  h1 {
    font-size: 2.5em;
    line-height: 1.1em;
    margin: 0 0 .50em 0;
  }

  h2 {
    font-size: 1.75em;
    margin: 1em 0 .50em 0;
  }

  h3 {
    margin: 25px 0 10px 0;
  }

  h4 {
    margin: 0;
    font-size: 105%;
  }

  a {
    color: #058;
    text-decoration: none;
    transition: color .3s ease-in-out;
  }

  a:hover {
    color: #e08524;
    transition: color .3s ease-in-out;
  }

  pre, code, .mono, .name {
    font-family: "Ubuntu Mono", "Cousine", "DejaVu Sans Mono", monospace;
  }

  .title .name {
    font-weight: bold;
  }
  .section-title {
    margin-top: 2em;
  }
  .ident {
    color: #900;
  }

  code {
    background: #f9f9f9;
  } 

  pre {
    background: #fefefe;
    border: 1px solid #ddd;
    box-shadow: 2px 2px 0 #f3f3f3;
    margin: 0 30px;
    padding: 15px 30px;
  }

  .codehilite {
    margin: 0 30px 10px 30px;
  }

    .codehilite pre {
      margin: 0;
    }
    .codehilite .err { background: #ff3300; color: #fff !important; } 

  table#module-list {
    font-size: 110%;
  }

    table#module-list tr td:first-child {
      padding-right: 10px;
      white-space: nowrap;
    }

    table#module-list td {
      vertical-align: top;
      padding-bottom: 8px;
    }

      table#module-list td p {
        margin: 0 0 7px 0;
      }

  .def {
    display: table;
  }

    .def p {
      display: table-cell;
      vertical-align: top;
      text-align: left;
    }

    .def p:first-child {
      white-space: nowrap;
    }

    .def p:last-child {
      width: 100%;
    }


  #index {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }
    ul#index .class_name {
      /* font-size: 110%; */
      font-weight: bold;
    }
    #index ul {
      margin: 0;
    }

  .item {
    margin: 0 0 15px 0;
  }

    .item .class {
      margin: 0 0 25px 30px;
    }

      .item .class ul.class_list {
        margin: 0 0 20px 0;
      }

    .item .name {
      background: #fafafa;
      margin: 0;
      font-weight: bold;
      padding: 5px 10px;
      border-radius: 3px;
      display: inline-block;
      min-width: 40%;
    }
      .item .name:hover {
        background: #f6f6f6;
      }

    .item .empty_desc {
      margin: 0 0 5px 0;
      padding: 0;
    }

    .item .inheritance {
      margin: 3px 0 0 30px;
    }

    .item .inherited {
      color: #666;
    }

    .item .desc {
      padding: 0 8px;
      margin: 0;
    }

      .item .desc p {
        margin: 0 0 10px 0;
      }

    .source_cont {
      margin: 0;
      padding: 0;
    }

    .source_link a {
      background: #ffc300;
      font-weight: 400;
      font-size: .75em;
      text-transform: uppercase;
      color: #fff;
      text-shadow: 1px 1px 0 #f4b700;
      
      padding: 3px 8px;
      border-radius: 2px;
      transition: background .3s ease-in-out;
    }
      .source_link a:hover {
        background: #FF7200;
        text-shadow: none;
        transition: background .3s ease-in-out;
      }

    .source {
      display: none;
      max-height: 600px;
      overflow-y: scroll;
      margin-bottom: 15px;
    }

      .source .codehilite {
        margin: 0;
      }

  .desc h1, .desc h2, .desc h3 {
    font-size: 100% !important;
  }
  .clear {
    clear: both;
  }

  @media all and (max-width: 950px) {
    #sidebar {
      width: 35%;
    }
    #content {
      width: 65%;
    }
  }
  @media all and (max-width: 650px) {
    #top {
      display: none;
    }
    #sidebar {
      float: none;
      width: auto;
    }
    #content {
      float: none;
      width: auto;
      padding: 30px;
    }

    #index ul {
      padding: 0;
      margin-bottom: 15px;
    }
    #index ul li {
      display: inline-block;
      margin-right: 30px;
    }
    #footer {
      text-align: left;
    }
    #footer p {
      display: block;
      margin: inherit;
    }
  }

  /*****************************/

  </style>

  <style type="text/css">
  .codehilite .hll { background-color: #ffffcc }
.codehilite  { background: #f8f8f8; }
.codehilite .c { color: #408080; font-style: italic } /* Comment */
.codehilite .err { border: 1px solid #FF0000 } /* Error */
.codehilite .k { color: #008000; font-weight: bold } /* Keyword */
.codehilite .o { color: #666666 } /* Operator */
.codehilite .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.codehilite .cp { color: #BC7A00 } /* Comment.Preproc */
.codehilite .c1 { color: #408080; font-style: italic } /* Comment.Single */
.codehilite .cs { color: #408080; font-style: italic } /* Comment.Special */
.codehilite .gd { color: #A00000 } /* Generic.Deleted */
.codehilite .ge { font-style: italic } /* Generic.Emph */
.codehilite .gr { color: #FF0000 } /* Generic.Error */
.codehilite .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.codehilite .gi { color: #00A000 } /* Generic.Inserted */
.codehilite .go { color: #888888 } /* Generic.Output */
.codehilite .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.codehilite .gs { font-weight: bold } /* Generic.Strong */
.codehilite .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.codehilite .gt { color: #0044DD } /* Generic.Traceback */
.codehilite .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.codehilite .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.codehilite .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.codehilite .kp { color: #008000 } /* Keyword.Pseudo */
.codehilite .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.codehilite .kt { color: #B00040 } /* Keyword.Type */
.codehilite .m { color: #666666 } /* Literal.Number */
.codehilite .s { color: #BA2121 } /* Literal.String */
.codehilite .na { color: #7D9029 } /* Name.Attribute */
.codehilite .nb { color: #008000 } /* Name.Builtin */
.codehilite .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.codehilite .no { color: #880000 } /* Name.Constant */
.codehilite .nd { color: #AA22FF } /* Name.Decorator */
.codehilite .ni { color: #999999; font-weight: bold } /* Name.Entity */
.codehilite .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.codehilite .nf { color: #0000FF } /* Name.Function */
.codehilite .nl { color: #A0A000 } /* Name.Label */
.codehilite .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.codehilite .nt { color: #008000; font-weight: bold } /* Name.Tag */
.codehilite .nv { color: #19177C } /* Name.Variable */
.codehilite .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.codehilite .w { color: #bbbbbb } /* Text.Whitespace */
.codehilite .mb { color: #666666 } /* Literal.Number.Bin */
.codehilite .mf { color: #666666 } /* Literal.Number.Float */
.codehilite .mh { color: #666666 } /* Literal.Number.Hex */
.codehilite .mi { color: #666666 } /* Literal.Number.Integer */
.codehilite .mo { color: #666666 } /* Literal.Number.Oct */
.codehilite .sb { color: #BA2121 } /* Literal.String.Backtick */
.codehilite .sc { color: #BA2121 } /* Literal.String.Char */
.codehilite .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.codehilite .s2 { color: #BA2121 } /* Literal.String.Double */
.codehilite .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.codehilite .sh { color: #BA2121 } /* Literal.String.Heredoc */
.codehilite .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.codehilite .sx { color: #008000 } /* Literal.String.Other */
.codehilite .sr { color: #BB6688 } /* Literal.String.Regex */
.codehilite .s1 { color: #BA2121 } /* Literal.String.Single */
.codehilite .ss { color: #19177C } /* Literal.String.Symbol */
.codehilite .bp { color: #008000 } /* Name.Builtin.Pseudo */
.codehilite .vc { color: #19177C } /* Name.Variable.Class */
.codehilite .vg { color: #19177C } /* Name.Variable.Global */
.codehilite .vi { color: #19177C } /* Name.Variable.Instance */
.codehilite .il { color: #666666 } /* Literal.Number.Integer.Long */
  </style>

  <style type="text/css">
  
/* ==========================================================================
   EXAMPLE Media Queries for Responsive Design.
   These examples override the primary ('mobile first') styles.
   Modify as content requires.
   ========================================================================== */

@media only screen and (min-width: 35em) {
    /* Style adjustments for viewports that meet the condition */
}

@media print,
       (-o-min-device-pixel-ratio: 5/4),
       (-webkit-min-device-pixel-ratio: 1.25),
       (min-resolution: 120dpi) {
    /* Style adjustments for high resolution devices */
}

/* ==========================================================================
   Print styles.
   Inlined to avoid required HTTP connection: h5bp.com/r
   ========================================================================== */

@media print {
    * {
        background: transparent !important;
        color: #000 !important; /* Black prints faster: h5bp.com/s */
        box-shadow: none !important;
        text-shadow: none !important;
    }

    a,
    a:visited {
        text-decoration: underline;
    }

    a[href]:after {
        content: " (" attr(href) ")";
    }

    abbr[title]:after {
        content: " (" attr(title) ")";
    }

    /*
     * Don't show links for images, or javascript/internal links
     */

    .ir a:after,
    a[href^="javascript:"]:after,
    a[href^="#"]:after {
        content: "";
    }

    pre,
    blockquote {
        border: 1px solid #999;
        page-break-inside: avoid;
    }

    thead {
        display: table-header-group; /* h5bp.com/t */
    }

    tr,
    img {
        page-break-inside: avoid;
    }

    img {
        max-width: 100% !important;
    }

    @page {
        margin: 0.5cm;
    }

    p,
    h2,
    h3 {
        orphans: 3;
        widows: 3;
    }

    h2,
    h3 {
        page-break-after: avoid;
    }
}

  </style>

  <script type="text/javascript">
  function toggle(id, $link) {
    $node = document.getElementById(id);
    if (!$node)
    return;
    if (!$node.style.display || $node.style.display == 'none') {
    $node.style.display = 'block';
    $link.innerHTML = 'Hide source &nequiv;';
    } else {
    $node.style.display = 'none';
    $link.innerHTML = 'Show source &equiv;';
    }
  }
  </script>
</head>
<body>
<a href="#" id="top">Top</a>

<div id="container">
    
  
  <div id="sidebar">
    <h1>Index</h1>
    <ul id="index">
    <li class="set"><h3><a href="#header-variables">Module variables</a></h3>
      
  <ul>
    <li class="mono"><a href="#vt102.colors">colors</a></li>
    <li class="mono"><a href="#vt102.text">text</a></li>
  </ul>

    </li>


    <li class="set"><h3><a href="#header-classes">Classes</a></h3>
      <ul>
        <li class="mono">
        <span class="class_name"><a href="#vt102.StreamProcessError">StreamProcessError</a></span>
        
        </li>
        <li class="mono">
        <span class="class_name"><a href="#vt102.screen">screen</a></span>
        
          
  <ul>
    <li class="mono"><a href="#vt102.screen.__init__">__init__</a></li>
    <li class="mono"><a href="#vt102.screen.attach">attach</a></li>
    <li class="mono"><a href="#vt102.screen.cursor">cursor</a></li>
    <li class="mono"><a href="#vt102.screen.resize">resize</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#vt102.stream">stream</a></span>
        
          
  <ul>
    <li class="mono"><a href="#vt102.stream.__init__">__init__</a></li>
    <li class="mono"><a href="#vt102.stream.add_event_listener">add_event_listener</a></li>
    <li class="mono"><a href="#vt102.stream.consume">consume</a></li>
    <li class="mono"><a href="#vt102.stream.dispatch">dispatch</a></li>
    <li class="mono"><a href="#vt102.stream.process">process</a></li>
  </ul>

        </li>
      </ul>
    </li>

    </ul>
  </div>

    <article id="content">
      
  

  


  <header id="section-intro">
  <h1 class="title"><span class="name">vt102</span> module</h1>
  <p><a href="http://github.com/samfoo/vt102">vt102</a> is an in memory vt1xx terminal
emulator. It supports all the most common terminal escape sequences, including
text attributes and color. </p>
<p>It's an in memory vt1XX-compatible terminal emulator. The <em>XX</em> stands for a
series video terminals, developed by
<a href="http://en.wikipedia.org/wiki/Digital_Equipment_Corporation">DEC</a> between 1970
and 1995. The first, and most famous one, was VT100 terminal, which is now a
de-facto standard for all virtual terminal emulators.
<a href="http://github.com/samfoo/vt102">vt102</a> is one such emulator.</p>
<p>Why would you want to use a terminal emulator?</p>
<ul>
<li>Screen scraping some terminal or curses app.</li>
<li>Writing your own graphical terminal emulator.</li>
<li>... seriously, that's about it.</li>
</ul>
<p>Here's a quick example:</p>
<div class="codehilite"><pre><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">vt102</span> <span class="kn">import</span> <span class="n">screen</span><span class="p">,</span> <span class="n">stream</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">st</span> <span class="o">=</span> <span class="n">stream</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">sc</span> <span class="o">=</span> <span class="n">screen</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="n">sc</span><span class="p">)</span>
<span class="p">[</span><span class="s">&quot;          &quot;</span><span class="p">,</span>
 <span class="s">&quot;          &quot;</span><span class="p">,</span>
 <span class="s">&quot;          &quot;</span><span class="p">,</span>
 <span class="s">&quot;          &quot;</span><span class="p">,</span>
 <span class="s">&quot;          &quot;</span><span class="p">,</span>
 <span class="s">&quot;          &quot;</span><span class="p">,</span>
 <span class="s">&quot;          &quot;</span><span class="p">,</span>
 <span class="s">&quot;          &quot;</span><span class="p">,</span>
 <span class="s">&quot;          &quot;</span><span class="p">,</span>
 <span class="s">&quot;          &quot;</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">sc</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">st</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">st</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="s">&quot;Text goes here&quot;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="n">sc</span><span class="p">)</span>
<span class="p">[</span><span class="s">&quot;Text goes &quot;</span><span class="p">,</span>
 <span class="s">&quot;here      &quot;</span><span class="p">,</span>
 <span class="s">&quot;          &quot;</span><span class="p">,</span>
 <span class="s">&quot;          &quot;</span><span class="p">,</span>
 <span class="s">&quot;          &quot;</span><span class="p">,</span>
 <span class="s">&quot;          &quot;</span><span class="p">,</span>
 <span class="s">&quot;          &quot;</span><span class="p">,</span>
 <span class="s">&quot;          &quot;</span><span class="p">,</span>
 <span class="s">&quot;          &quot;</span><span class="p">,</span>
 <span class="s">&quot;          &quot;</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">st</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\x1b</span><span class="s">[H</span><span class="se">\x1b</span><span class="s">[K&quot;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="n">sc</span><span class="p">)</span>
<span class="p">[</span><span class="s">&quot;          &quot;</span><span class="p">,</span>
 <span class="s">&quot;here      &quot;</span><span class="p">,</span>
 <span class="s">&quot;          &quot;</span><span class="p">,</span>
 <span class="s">&quot;          &quot;</span><span class="p">,</span>
 <span class="s">&quot;          &quot;</span><span class="p">,</span>
 <span class="s">&quot;          &quot;</span><span class="p">,</span>
 <span class="s">&quot;          &quot;</span><span class="p">,</span>
 <span class="s">&quot;          &quot;</span><span class="p">,</span>
 <span class="s">&quot;          &quot;</span><span class="p">,</span>
 <span class="s">&quot;          &quot;</span><span class="p">]</span>
</pre></div>


<p>Here's a real-world example:</p>
<div class="codehilite"><pre><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">vt102</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">stream</span> <span class="o">=</span> <span class="n">vt102</span><span class="o">.</span><span class="n">stream</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">screen</span> <span class="o">=</span> <span class="n">vt102</span><span class="o">.</span><span class="n">screen</span><span class="p">((</span><span class="mi">24</span><span class="p">,</span><span class="mi">80</span><span class="p">))</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">screen</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">stream</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="s">u&quot;</span><span class="se">\u001b</span><span class="s">7</span><span class="se">\u001b</span><span class="s">[?47h</span><span class="se">\u001b</span><span class="s">)0</span><span class="se">\u001b</span><span class="s">[H</span><span class="se">\u001b</span><span class="s">[2J</span><span class="se">\u001b</span><span class="s">[H&quot;</span> <span class="o">+</span>
<span class="o">...</span>                <span class="s">u&quot;</span><span class="se">\u001b</span><span class="s">[2;1HNetHack, Copyright 1985-2003</span><span class="se">\r\u001b</span><span class="s">[3;1&quot;</span> <span class="o">+</span>
<span class="o">...</span>                <span class="s">u&quot;H         By Stichting Mathematisch Centrum and M. &quot;</span> <span class="o">+</span>
<span class="o">...</span>                <span class="s">u&quot;Stephenson.</span><span class="se">\r\u001b</span><span class="s">[4;1H         See license for de&quot;</span> <span class="o">+</span>
<span class="o">...</span>                <span class="s">u&quot;tails.</span><span class="se">\r\u001b</span><span class="s">[5;1H</span><span class="se">\u001b</span><span class="s">[6;1H</span><span class="se">\u001b</span><span class="s">[7;1HShall I pi&quot;</span> <span class="o">+</span>
<span class="o">...</span>                <span class="s">u&quot;ck a character&#39;s race, role, gender and alignment f&quot;</span> <span class="o">+</span>
<span class="o">...</span>                <span class="s">u&quot;or you? [ynq] &quot;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="n">screen</span><span class="p">)</span>
<span class="p">[</span><span class="s">&quot;                                                                                &quot;</span><span class="p">,</span>
 <span class="s">&quot;NetHack, Copyright 1985-2003                                                    &quot;</span><span class="p">,</span>
 <span class="s">&quot;         By Stichting Mathematisch Centrum and M. Stephenson.                   &quot;</span><span class="p">,</span>
 <span class="s">&quot;         See license for details.                                               &quot;</span><span class="p">,</span>
 <span class="s">&quot;                                                                                &quot;</span><span class="p">,</span>
 <span class="s">&quot;                                                                                &quot;</span><span class="p">,</span>
 <span class="s">&quot;Shall I pick a character&#39;s race, role, gender and alignment for you? [ynq]      &quot;</span><span class="p">,</span>
 <span class="s">&quot;                                                                                &quot;</span><span class="p">,</span>
 <span class="s">&quot;                                                                                &quot;</span><span class="p">,</span>
 <span class="s">&quot;                                                                                &quot;</span><span class="p">,</span>
 <span class="s">&quot;                                                                                &quot;</span><span class="p">,</span>
 <span class="s">&quot;                                                                                &quot;</span><span class="p">,</span>
 <span class="s">&quot;                                                                                &quot;</span><span class="p">,</span>
 <span class="s">&quot;                                                                                &quot;</span><span class="p">,</span>
 <span class="s">&quot;                                                                                &quot;</span><span class="p">,</span>
 <span class="s">&quot;                                                                                &quot;</span><span class="p">,</span>
 <span class="s">&quot;                                                                                &quot;</span><span class="p">,</span>
 <span class="s">&quot;                                                                                &quot;</span><span class="p">,</span>
 <span class="s">&quot;                                                                                &quot;</span><span class="p">,</span>
 <span class="s">&quot;                                                                                &quot;</span><span class="p">,</span>
 <span class="s">&quot;                                                                                &quot;</span><span class="p">,</span>
 <span class="s">&quot;                                                                                &quot;</span><span class="p">,</span>
 <span class="s">&quot;                                                                                &quot;</span><span class="p">,</span>
 <span class="s">&quot;                                                                                &quot;</span><span class="p">]</span>
</pre></div>


<blockquote>
<blockquote>
<blockquote></blockquote>
</blockquote>
</blockquote>
  
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-vt102', this);">Show source &equiv;</a></p>
  <div id="source-vt102" class="source">
    <div class="codehilite"><pre><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">[vt102](http://github.com/samfoo/vt102) is an in memory vt1xx terminal</span>
<span class="sd">emulator. It supports all the most common terminal escape sequences, including</span>
<span class="sd">text attributes and color. </span>

<span class="sd">It&#39;s an in memory vt1XX-compatible terminal emulator. The *XX* stands for a</span>
<span class="sd">series video terminals, developed by</span>
<span class="sd">[DEC](http://en.wikipedia.org/wiki/Digital_Equipment_Corporation) between 1970</span>
<span class="sd">and 1995. The first, and most famous one, was VT100 terminal, which is now a</span>
<span class="sd">de-facto standard for all virtual terminal emulators.</span>
<span class="sd">[vt102](http://github.com/samfoo/vt102) is one such emulator.</span>

<span class="sd">Why would you want to use a terminal emulator?</span>

<span class="sd">* Screen scraping some terminal or curses app.</span>
<span class="sd">* Writing your own graphical terminal emulator.</span>
<span class="sd">* ... seriously, that&#39;s about it.</span>

<span class="sd">Here&#39;s a quick example:</span>

<span class="sd">    &gt;&gt;&gt; from vt102 import screen, stream</span>
<span class="sd">    &gt;&gt;&gt; st = stream()</span>
<span class="sd">    &gt;&gt;&gt; sc = screen((10, 10))</span>
<span class="sd">    &gt;&gt;&gt; print(sc)</span>
<span class="sd">    [&quot;          &quot;,</span>
<span class="sd">     &quot;          &quot;,</span>
<span class="sd">     &quot;          &quot;,</span>
<span class="sd">     &quot;          &quot;,</span>
<span class="sd">     &quot;          &quot;,</span>
<span class="sd">     &quot;          &quot;,</span>
<span class="sd">     &quot;          &quot;,</span>
<span class="sd">     &quot;          &quot;,</span>
<span class="sd">     &quot;          &quot;,</span>
<span class="sd">     &quot;          &quot;]</span>
<span class="sd">    &gt;&gt;&gt; sc.attach(st)</span>
<span class="sd">    &gt;&gt;&gt; st.process(&quot;Text goes here&quot;)</span>
<span class="sd">    &gt;&gt;&gt; print(sc)</span>
<span class="sd">    [&quot;Text goes &quot;,</span>
<span class="sd">     &quot;here      &quot;,</span>
<span class="sd">     &quot;          &quot;,</span>
<span class="sd">     &quot;          &quot;,</span>
<span class="sd">     &quot;          &quot;,</span>
<span class="sd">     &quot;          &quot;,</span>
<span class="sd">     &quot;          &quot;,</span>
<span class="sd">     &quot;          &quot;,</span>
<span class="sd">     &quot;          &quot;,</span>
<span class="sd">     &quot;          &quot;]</span>
<span class="sd">    &gt;&gt;&gt; st.process(&quot;\\x1b[H\\x1b[K&quot;)</span>
<span class="sd">    &gt;&gt;&gt; print(sc)</span>
<span class="sd">    [&quot;          &quot;,</span>
<span class="sd">     &quot;here      &quot;,</span>
<span class="sd">     &quot;          &quot;,</span>
<span class="sd">     &quot;          &quot;,</span>
<span class="sd">     &quot;          &quot;,</span>
<span class="sd">     &quot;          &quot;,</span>
<span class="sd">     &quot;          &quot;,</span>
<span class="sd">     &quot;          &quot;,</span>
<span class="sd">     &quot;          &quot;,</span>
<span class="sd">     &quot;          &quot;]</span>

<span class="sd">Here&#39;s a real-world example:</span>

<span class="sd">    &gt;&gt;&gt; import vt102</span>
<span class="sd">    &gt;&gt;&gt; stream = vt102.stream()</span>
<span class="sd">    &gt;&gt;&gt; screen = vt102.screen((24,80))</span>
<span class="sd">    &gt;&gt;&gt; screen.attach(stream)</span>
<span class="sd">    &gt;&gt;&gt; stream.process(u&quot;\\u001b7\\u001b[?47h\\u001b)0\\u001b[H\\u001b[2J\\u001b[H&quot; +</span>
<span class="sd">    ...                u&quot;\\u001b[2;1HNetHack, Copyright 1985-2003\\r\\u001b[3;1&quot; +</span>
<span class="sd">    ...                u&quot;H         By Stichting Mathematisch Centrum and M. &quot; +</span>
<span class="sd">    ...                u&quot;Stephenson.\\r\\u001b[4;1H         See license for de&quot; +</span>
<span class="sd">    ...                u&quot;tails.\\r\\u001b[5;1H\\u001b[6;1H\\u001b[7;1HShall I pi&quot; +</span>
<span class="sd">    ...                u&quot;ck a character&#39;s race, role, gender and alignment f&quot; +</span>
<span class="sd">    ...                u&quot;or you? [ynq] &quot;)</span>
<span class="sd">    &gt;&gt;&gt; print(screen)</span>
<span class="sd">    [&quot;                                                                                &quot;,</span>
<span class="sd">     &quot;NetHack, Copyright 1985-2003                                                    &quot;,</span>
<span class="sd">     &quot;         By Stichting Mathematisch Centrum and M. Stephenson.                   &quot;,</span>
<span class="sd">     &quot;         See license for details.                                               &quot;,</span>
<span class="sd">     &quot;                                                                                &quot;,</span>
<span class="sd">     &quot;                                                                                &quot;,</span>
<span class="sd">     &quot;Shall I pick a character&#39;s race, role, gender and alignment for you? [ynq]      &quot;,</span>
<span class="sd">     &quot;                                                                                &quot;,</span>
<span class="sd">     &quot;                                                                                &quot;,</span>
<span class="sd">     &quot;                                                                                &quot;,</span>
<span class="sd">     &quot;                                                                                &quot;,</span>
<span class="sd">     &quot;                                                                                &quot;,</span>
<span class="sd">     &quot;                                                                                &quot;,</span>
<span class="sd">     &quot;                                                                                &quot;,</span>
<span class="sd">     &quot;                                                                                &quot;,</span>
<span class="sd">     &quot;                                                                                &quot;,</span>
<span class="sd">     &quot;                                                                                &quot;,</span>
<span class="sd">     &quot;                                                                                &quot;,</span>
<span class="sd">     &quot;                                                                                &quot;,</span>
<span class="sd">     &quot;                                                                                &quot;,</span>
<span class="sd">     &quot;                                                                                &quot;,</span>
<span class="sd">     &quot;                                                                                &quot;,</span>
<span class="sd">     &quot;                                                                                &quot;,</span>
<span class="sd">     &quot;                                                                                &quot;]</span>
<span class="sd">&gt;&gt;&gt; </span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">string</span>
<span class="kn">import</span> <span class="nn">codecs</span>

<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">copy</span>

<span class="kn">from</span> <span class="nn">.graphics</span> <span class="kn">import</span> <span class="n">text</span><span class="p">,</span> <span class="n">colors</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">control</span> <span class="k">as</span> <span class="n">ctrl</span><span class="p">,</span> <span class="n">escape</span> <span class="k">as</span> <span class="n">esc</span>
<span class="c"># from .control import *</span>
<span class="c"># from .escape import *</span>

<span class="k">class</span> <span class="nc">StreamProcessError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">stream</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A stream is the state machine that parses a stream of terminal characters</span>
<span class="sd">    and dispatches events based on what it sees. This can be attached to a </span>
<span class="sd">    screen object and it&#39;s events, or can be used some other way.</span>

<span class="sd">    `stream.basic`, `stream.escape`, and `stream.sequence` are the relevant </span>
<span class="sd">    events that get thrown with one addition: `print`. For details on the</span>
<span class="sd">    event parameters, see the [vt102 user&#39;s</span>
<span class="sd">    guide](http://vt100.net/docs/vt102-ug/)</span>

<span class="sd">    Quick example:</span>

<span class="sd">        &gt;&gt;&gt; s = stream()</span>
<span class="sd">        &gt;&gt;&gt; class Cursor:</span>
<span class="sd">        ...     def __init__(self):</span>
<span class="sd">        ...         self.x = 10; self.y = 10</span>
<span class="sd">        ...     def up(self, count):</span>
<span class="sd">        ...         self.y -= count</span>
<span class="sd">        ...</span>
<span class="sd">        &gt;&gt;&gt; c = Cursor()</span>
<span class="sd">        &gt;&gt;&gt; s.add_event_listener(&quot;cursor-up&quot;, c.up)</span>
<span class="sd">        &gt;&gt;&gt; s.process(u&quot;\\x00\\x1b[5A&quot;) # Move the cursor up 5 rows.</span>
<span class="sd">        &gt;&gt;&gt; print(c.y)</span>
<span class="sd">        5</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">basic</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">ctrl</span><span class="o">.</span><span class="n">BS</span><span class="p">:</span> <span class="s">&quot;backspace&quot;</span><span class="p">,</span>
        <span class="n">ctrl</span><span class="o">.</span><span class="n">HT</span><span class="p">:</span> <span class="s">&quot;tab&quot;</span><span class="p">,</span>
        <span class="n">ctrl</span><span class="o">.</span><span class="n">LF</span><span class="p">:</span> <span class="s">&quot;linefeed&quot;</span><span class="p">,</span>
        <span class="n">ctrl</span><span class="o">.</span><span class="n">VT</span><span class="p">:</span> <span class="s">&quot;linefeed&quot;</span><span class="p">,</span>
        <span class="n">ctrl</span><span class="o">.</span><span class="n">FF</span><span class="p">:</span> <span class="s">&quot;linefeed&quot;</span><span class="p">,</span>
        <span class="n">ctrl</span><span class="o">.</span><span class="n">CR</span><span class="p">:</span> <span class="s">&quot;carriage-return&quot;</span><span class="p">,</span>
        <span class="n">ctrl</span><span class="o">.</span><span class="n">SI</span><span class="p">:</span> <span class="s">&quot;shift-in&quot;</span><span class="p">,</span>
        <span class="n">ctrl</span><span class="o">.</span><span class="n">SO</span><span class="p">:</span> <span class="s">&quot;shift-out&quot;</span><span class="p">,</span>
        <span class="n">ctrl</span><span class="o">.</span><span class="n">BEL</span><span class="p">:</span> <span class="s">&quot;bell&quot;</span>
    <span class="p">}</span>

    <span class="n">escape</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">esc</span><span class="o">.</span><span class="n">IND</span><span class="p">:</span> <span class="s">&quot;index&quot;</span><span class="p">,</span>
        <span class="n">esc</span><span class="o">.</span><span class="n">RI</span><span class="p">:</span> <span class="s">&quot;reverse-index&quot;</span><span class="p">,</span>
        <span class="n">esc</span><span class="o">.</span><span class="n">NEL</span><span class="p">:</span> <span class="s">&quot;linefeed&quot;</span><span class="p">,</span>
        <span class="n">esc</span><span class="o">.</span><span class="n">DECSC</span><span class="p">:</span> <span class="s">&quot;store-cursor&quot;</span><span class="p">,</span>
        <span class="n">esc</span><span class="o">.</span><span class="n">DECRC</span><span class="p">:</span> <span class="s">&quot;restore-cursor&quot;</span><span class="p">,</span>
        <span class="n">esc</span><span class="o">.</span><span class="n">RLF</span><span class="p">:</span> <span class="s">&quot;reverse-linefeed&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">sequence</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">esc</span><span class="o">.</span><span class="n">CUU</span><span class="p">:</span> <span class="s">&quot;cursor-up&quot;</span><span class="p">,</span>
        <span class="n">esc</span><span class="o">.</span><span class="n">CUD</span><span class="p">:</span> <span class="s">&quot;cursor-down&quot;</span><span class="p">,</span>
        <span class="n">esc</span><span class="o">.</span><span class="n">CUF</span><span class="p">:</span> <span class="s">&quot;cursor-right&quot;</span><span class="p">,</span>
        <span class="n">esc</span><span class="o">.</span><span class="n">CUB</span><span class="p">:</span> <span class="s">&quot;cursor-left&quot;</span><span class="p">,</span>
        <span class="n">esc</span><span class="o">.</span><span class="n">CUP</span><span class="p">:</span> <span class="s">&quot;cursor-move&quot;</span><span class="p">,</span>
        <span class="n">esc</span><span class="o">.</span><span class="n">HVP</span><span class="p">:</span> <span class="s">&quot;cursor-move&quot;</span><span class="p">,</span>
        <span class="n">esc</span><span class="o">.</span><span class="n">EL</span><span class="p">:</span> <span class="s">&quot;erase-in-line&quot;</span><span class="p">,</span>
        <span class="n">esc</span><span class="o">.</span><span class="n">ED</span><span class="p">:</span> <span class="s">&quot;erase-in-display&quot;</span><span class="p">,</span>
        <span class="n">esc</span><span class="o">.</span><span class="n">DCH</span><span class="p">:</span> <span class="s">&quot;delete-characters&quot;</span><span class="p">,</span>
        <span class="n">esc</span><span class="o">.</span><span class="n">IL</span><span class="p">:</span> <span class="s">&quot;insert-lines&quot;</span><span class="p">,</span>
        <span class="n">esc</span><span class="o">.</span><span class="n">DL</span><span class="p">:</span> <span class="s">&quot;delete-lines&quot;</span><span class="p">,</span>
        <span class="n">esc</span><span class="o">.</span><span class="n">SGR</span><span class="p">:</span> <span class="s">&quot;select-graphic-rendition&quot;</span><span class="p">,</span>
        <span class="n">esc</span><span class="o">.</span><span class="n">DECSTBM</span><span class="p">:</span> <span class="s">&quot;set-margins&quot;</span><span class="p">,</span>
        <span class="n">esc</span><span class="o">.</span><span class="n">IRMI</span><span class="p">:</span> <span class="s">&quot;set-insert&quot;</span><span class="p">,</span>
        <span class="n">esc</span><span class="o">.</span><span class="n">IRMR</span><span class="p">:</span> <span class="s">&quot;set-replace&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fail_on_unknown_esc</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s">&quot;stream&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_param</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">listeners</span> <span class="o">=</span> <span class="p">{}</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">fail_on_unknown_esc</span> <span class="o">=</span> <span class="n">fail_on_unknown_esc</span>

    <span class="k">def</span> <span class="nf">_escape_sequence</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">char</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handle characters seen when in an escape sequence. Most non-vt52</span>
<span class="sd">        commands start with a left-bracket after the escape and then a </span>
<span class="sd">        stream of parameters and a command.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">num</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">char</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">char</span> <span class="o">==</span> <span class="s">&quot;[&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s">&quot;escape-lb&quot;</span>
        <span class="k">elif</span> <span class="n">char</span> <span class="o">==</span> <span class="s">&quot;(&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s">&quot;charset-g0&quot;</span>
        <span class="k">elif</span> <span class="n">char</span> <span class="o">==</span> <span class="s">&quot;)&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s">&quot;charset-g1&quot;</span>
        <span class="k">elif</span> <span class="n">num</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">escape</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dispatch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">escape</span><span class="p">[</span><span class="n">num</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s">&quot;stream&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">fail_on_unknown_esc</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">StreamProcessError</span><span class="p">(</span><span class="s">&quot;Unexpected character &#39;</span><span class="si">%c</span><span class="s">&#39; == &#39;0x</span><span class="si">%02x</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">char</span><span class="p">,</span> <span class="nb">ord</span><span class="p">(</span><span class="n">char</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">_end_escape_sequence</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">char</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handle the end of an escape sequence. The final character in an escape</span>
<span class="sd">        sequence is the command to execute, which corresponds to the event that</span>
<span class="sd">        is dispatched here.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">num</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">char</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">num</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sequence</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dispatch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sequence</span><span class="p">[</span><span class="n">num</span><span class="p">],</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s">&quot;stream&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_param</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">_escape_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">char</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parse parameters in an escape sequence. Parameters are a list of</span>
<span class="sd">        numbers in ascii (e.g. &#39;12&#39;, &#39;4&#39;, &#39;42&#39;, etc) separated by a semicolon</span>
<span class="sd">        (e.g. &quot;12;4;42&quot;).</span>
<span class="sd">        </span>
<span class="sd">        See the [vt102 user guide](http://vt100.net/docs/vt102-ug/) for more</span>
<span class="sd">        details on the formatting of escape parameters. </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">char</span> <span class="o">==</span> <span class="s">&quot;;&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_param</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_param</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="k">elif</span> <span class="n">char</span> <span class="o">==</span> <span class="s">&quot;?&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s">&quot;mode&quot;</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">char</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_param</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_param</span><span class="p">))</span>

            <span class="c"># If we&#39;re in parameter parsing mode, but we see a non-numeric </span>
            <span class="c"># value, it must be the end of the control sequence.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_end_escape_sequence</span><span class="p">(</span><span class="n">char</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_param</span> <span class="o">+=</span> <span class="n">char</span>

    <span class="k">def</span> <span class="nf">_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">char</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">char</span> <span class="ow">in</span> <span class="s">&quot;lh&quot;</span><span class="p">:</span>
            <span class="c"># &#39;l&#39; or &#39;h&#39; designates the end of a mode stream. We don&#39;t</span>
            <span class="c"># really care about mode streams so anything else seen while</span>
            <span class="c"># in the mode state, is just ignored.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s">&quot;stream&quot;</span>

    <span class="k">def</span> <span class="nf">_charset_g0</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">char</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dispatch</span><span class="p">(</span><span class="s">&quot;charset-g0&quot;</span><span class="p">,</span> <span class="n">char</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s">&quot;stream&quot;</span>

    <span class="k">def</span> <span class="nf">_charset_g1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">char</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dispatch</span><span class="p">(</span><span class="s">&quot;charset-g1&quot;</span><span class="p">,</span> <span class="n">char</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s">&quot;stream&quot;</span>

    <span class="k">def</span> <span class="nf">_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">char</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Process a character when in the</span>
<span class="sd">        default &#39;stream&#39; state.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">num</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">char</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">num</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">basic</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dispatch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">basic</span><span class="p">[</span><span class="n">num</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">num</span> <span class="o">==</span> <span class="n">ctrl</span><span class="o">.</span><span class="n">ESC</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s">&quot;escape&quot;</span>
        <span class="k">elif</span> <span class="n">num</span> <span class="o">==</span> <span class="mh">0x00</span><span class="p">:</span>
            <span class="c"># nulls are just ignored.</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">dispatch</span><span class="p">(</span><span class="s">&quot;print&quot;</span><span class="p">,</span> <span class="n">char</span><span class="p">)</span> 

    <span class="k">def</span> <span class="nf">consume</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">char</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Consume a single character and advance the state as necessary.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s">&quot;stream&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_stream</span><span class="p">(</span><span class="n">char</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s">&quot;escape&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_escape_sequence</span><span class="p">(</span><span class="n">char</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s">&quot;escape-lb&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_escape_parameters</span><span class="p">(</span><span class="n">char</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s">&quot;mode&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span><span class="p">(</span><span class="n">char</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s">&quot;charset-g0&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_charset_g0</span><span class="p">(</span><span class="n">char</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s">&quot;charset-g1&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_charset_g1</span><span class="p">(</span><span class="n">char</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chars</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Consume a string of  and advance the state as necessary.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">chars</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">consume</span><span class="p">(</span><span class="n">chars</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">chars</span> <span class="o">=</span> <span class="n">chars</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

    <span class="k">def</span> <span class="nf">add_event_listener</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">function</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add an event listen for a particular event. Depending on the event</span>
<span class="sd">        there may or may not be parameters passed to function. Most escape </span>
<span class="sd">        streams also allow for an empty set of parameters (with a default</span>
<span class="sd">        value). Providing these default values and accepting variable arguments</span>
<span class="sd">        is the responsibility of function.</span>

<span class="sd">        More than one listener may be added for a single event. Each listener</span>
<span class="sd">        will be called.</span>
<span class="sd">        </span>
<span class="sd">        * **event** The event to listen for.</span>
<span class="sd">        * **function** The callable to invoke.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">event</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">listeners</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">listeners</span><span class="p">[</span><span class="n">event</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">listeners</span><span class="p">[</span><span class="n">event</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">function</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">dispatch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dispatch an event where `args` is a tuple of the arguments to send to </span>
<span class="sd">        any callbacks. If any callback throws an exception, the subsequent </span>
<span class="sd">        callbacks will be aborted.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">callback</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">listeners</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="p">[]):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">callback</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">callback</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">screen</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A screen is an in memory buffer of strings that represents the screen</span>
<span class="sd">    display of the terminal. It can be instantiated on it&#39;s own and given </span>
<span class="sd">    explicit commands, or it can be attached to a stream and will respond to</span>
<span class="sd">    events.</span>

<span class="sd">    The screen buffer can be accessed through the screen&#39;s `display` property.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c">#: Default colors and styling. The value of this attribute should</span>
    <span class="c">#: always be immutable, since shallow copies are made when resizing /</span>
    <span class="c">#: applying / deleting / printing.</span>
    <span class="c">#:</span>
    <span class="c">#: Attributes are represented by a three-tuple that consists of the</span>
    <span class="c">#: following:</span>
    <span class="c">#:</span>
    <span class="c">#:     1. A tuple of all the text attributes: `bold`, `underline`, etc</span>
    <span class="c">#:     2. The foreground color as a string, see</span>
    <span class="c">#:        :attr:`vt102.graphics.colors`</span>
    <span class="c">#:     3. The background color as a string, see</span>
    <span class="c">#:        :attr:`vt102.graphics.colors`</span>
    <span class="n">default_attributes</span> <span class="o">=</span> <span class="p">(),</span> <span class="s">&quot;default&quot;</span><span class="p">,</span> <span class="s">&quot;default&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">&quot;utf-8&quot;</span><span class="p">):</span>
        <span class="n">rows</span><span class="p">,</span> <span class="n">cols</span> <span class="o">=</span> <span class="n">shape</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span> <span class="o">=</span> <span class="n">encoding</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">decoder</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">getdecoder</span><span class="p">(</span><span class="n">encoding</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">irm</span> <span class="o">=</span> <span class="s">&quot;insert&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tabstops</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">g0</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">g1</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_charset</span> <span class="o">=</span> <span class="s">&quot;g0&quot;</span> 

        <span class="bp">self</span><span class="o">.</span><span class="n">cursor_save_stack</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c"># Initialize the screen to completely empty.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span> <span class="o">=</span> <span class="p">[</span><span class="s">u&quot; &quot;</span> <span class="o">*</span> <span class="n">cols</span><span class="p">]</span> <span class="o">*</span> <span class="n">rows</span>

        <span class="c"># Initialize the attributes to completely empty, but the same size as</span>
        <span class="c"># the screen.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">self</span><span class="o">.</span><span class="n">default_attributes</span><span class="p">]</span> <span class="o">*</span> <span class="n">cols</span><span class="p">]</span> <span class="o">*</span> <span class="n">rows</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cursor_attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_attributes</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;&quot;</span><span class="si">%s</span><span class="s">&quot;&#39;</span> <span class="o">%</span> <span class="n">l</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">]</span>

        <span class="k">return</span> <span class="s">&quot;[&quot;</span> <span class="o">+</span> <span class="s">&quot;,</span><span class="se">\n</span><span class="s"> &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;]&quot;</span>

    <span class="k">def</span> <span class="nf">attach</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attach this screen to a events that processes commands and dispatches </span>
<span class="sd">        events. Sets up the appropriate event handlers so that the screen will</span>
<span class="sd">        update itself automatically as the events processes data.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">events</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">events</span><span class="o">.</span><span class="n">add_event_listener</span><span class="p">(</span><span class="s">&quot;print&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">)</span>
            <span class="n">events</span><span class="o">.</span><span class="n">add_event_listener</span><span class="p">(</span><span class="s">&quot;backspace&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_backspace</span><span class="p">)</span>
            <span class="n">events</span><span class="o">.</span><span class="n">add_event_listener</span><span class="p">(</span><span class="s">&quot;tab&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tab</span><span class="p">)</span>
            <span class="n">events</span><span class="o">.</span><span class="n">add_event_listener</span><span class="p">(</span><span class="s">&quot;linefeed&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_linefeed</span><span class="p">)</span>
            <span class="n">events</span><span class="o">.</span><span class="n">add_event_listener</span><span class="p">(</span><span class="s">&quot;reverse-linefeed&quot;</span><span class="p">,</span> 
                                      <span class="bp">self</span><span class="o">.</span><span class="n">_reverse_linefeed</span><span class="p">)</span>
            <span class="n">events</span><span class="o">.</span><span class="n">add_event_listener</span><span class="p">(</span><span class="s">&quot;carriage-return&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_carriage_return</span><span class="p">)</span>
            <span class="n">events</span><span class="o">.</span><span class="n">add_event_listener</span><span class="p">(</span><span class="s">&quot;index&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index</span><span class="p">)</span>
            <span class="n">events</span><span class="o">.</span><span class="n">add_event_listener</span><span class="p">(</span><span class="s">&quot;reverse-index&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reverse_index</span><span class="p">)</span>
            <span class="n">events</span><span class="o">.</span><span class="n">add_event_listener</span><span class="p">(</span><span class="s">&quot;store-cursor&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_save_cursor</span><span class="p">)</span>
            <span class="n">events</span><span class="o">.</span><span class="n">add_event_listener</span><span class="p">(</span><span class="s">&quot;restore-cursor&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_restore_cursor</span><span class="p">)</span>
            <span class="n">events</span><span class="o">.</span><span class="n">add_event_listener</span><span class="p">(</span><span class="s">&quot;cursor-up&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cursor_up</span><span class="p">)</span>
            <span class="n">events</span><span class="o">.</span><span class="n">add_event_listener</span><span class="p">(</span><span class="s">&quot;cursor-down&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cursor_down</span><span class="p">)</span>
            <span class="n">events</span><span class="o">.</span><span class="n">add_event_listener</span><span class="p">(</span><span class="s">&quot;cursor-right&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cursor_forward</span><span class="p">)</span>
            <span class="n">events</span><span class="o">.</span><span class="n">add_event_listener</span><span class="p">(</span><span class="s">&quot;cursor-left&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cursor_back</span><span class="p">)</span>
            <span class="n">events</span><span class="o">.</span><span class="n">add_event_listener</span><span class="p">(</span><span class="s">&quot;cursor-move&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cursor_position</span><span class="p">)</span>
            <span class="n">events</span><span class="o">.</span><span class="n">add_event_listener</span><span class="p">(</span><span class="s">&quot;erase-in-line&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_erase_in_line</span><span class="p">)</span>
            <span class="n">events</span><span class="o">.</span><span class="n">add_event_listener</span><span class="p">(</span><span class="s">&quot;erase-in-display&quot;</span><span class="p">,</span> 
                                      <span class="bp">self</span><span class="o">.</span><span class="n">_erase_in_display</span><span class="p">)</span>
            <span class="n">events</span><span class="o">.</span><span class="n">add_event_listener</span><span class="p">(</span><span class="s">&quot;delete-characters&quot;</span><span class="p">,</span> 
                                      <span class="bp">self</span><span class="o">.</span><span class="n">_delete_character</span><span class="p">)</span>
            <span class="n">events</span><span class="o">.</span><span class="n">add_event_listener</span><span class="p">(</span><span class="s">&quot;insert-lines&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_insert_line</span><span class="p">)</span>
            <span class="n">events</span><span class="o">.</span><span class="n">add_event_listener</span><span class="p">(</span><span class="s">&quot;delete-lines&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delete_line</span><span class="p">)</span>
            <span class="n">events</span><span class="o">.</span><span class="n">add_event_listener</span><span class="p">(</span><span class="s">&quot;select-graphic-rendition&quot;</span><span class="p">,</span>
                                      <span class="bp">self</span><span class="o">.</span><span class="n">_select_graphic_rendition</span><span class="p">)</span>
            <span class="n">events</span><span class="o">.</span><span class="n">add_event_listener</span><span class="p">(</span><span class="s">&quot;charset-g0&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_charset_g0</span><span class="p">)</span>
            <span class="n">events</span><span class="o">.</span><span class="n">add_event_listener</span><span class="p">(</span><span class="s">&quot;charset-g1&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_charset_g1</span><span class="p">)</span>
            <span class="n">events</span><span class="o">.</span><span class="n">add_event_listener</span><span class="p">(</span><span class="s">&quot;shift-in&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shift_in</span><span class="p">)</span>
            <span class="n">events</span><span class="o">.</span><span class="n">add_event_listener</span><span class="p">(</span><span class="s">&quot;shift-out&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shift_out</span><span class="p">)</span>
            <span class="n">events</span><span class="o">.</span><span class="n">add_event_listener</span><span class="p">(</span><span class="s">&quot;bell&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bell</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">cursor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The current location of the cursor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">resize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shape</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Resize the screen. If the requested screen size has more rows than the</span>
<span class="sd">        existing screen, rows will be added at the bottom. If the requested</span>
<span class="sd">        size has less rows than the existing screen rows will be clipped at the</span>
<span class="sd">        top of the screen.</span>

<span class="sd">        Similarly if the existing screen has less columns than the requested </span>
<span class="sd">        size, columns will be added at the right, and it it has more, columns </span>
<span class="sd">        will be clipped at the right.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rows</span><span class="p">,</span> <span class="n">cols</span> <span class="o">=</span> <span class="n">shape</span>

        <span class="c"># Honestly though, you can&#39;t trust anyone these days...</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">rows</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">cols</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>

        <span class="c"># First resize the rows</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">rows</span><span class="p">:</span>
            <span class="c"># If the current display size is shorter than the requested screen</span>
            <span class="c"># size, then add rows to the bottom. Note that the old column size</span>
            <span class="c"># is used here so these new rows will get expanded/contracted as</span>
            <span class="c"># necessary by the column resize when it happens next.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">display</span> <span class="o">+=</span> <span class="p">[</span><span class="s">u&quot; &quot;</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">*</span> <span class="p">(</span><span class="n">rows</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span> <span class="o">+=</span> <span class="p">[[</span><span class="bp">self</span><span class="o">.</span><span class="n">default_attributes</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">*</span> \
                    <span class="p">(</span><span class="n">rows</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">rows</span><span class="p">:</span>
            <span class="c"># If the current display size is taller than the requested display,</span>
            <span class="c"># then take rows off the top.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">display</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">rows</span><span class="p">:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">rows</span><span class="p">:]</span>

        <span class="c"># Next, of course, resize the columns.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">cols</span><span class="p">:</span>
            <span class="c"># If the current display size is thinner than the requested size,</span>
            <span class="c"># expand each row to be the new size.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">display</span> <span class="o">=</span> \
                <span class="p">[</span><span class="n">row</span> <span class="o">+</span> <span class="p">(</span><span class="s">u&quot; &quot;</span> <span class="o">*</span> <span class="p">(</span><span class="n">cols</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span> <span class="o">=</span> \
                <span class="p">[</span><span class="n">row</span> <span class="o">+</span> <span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">default_attributes</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">cols</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">]</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">cols</span><span class="p">:</span>
            <span class="c"># If the current display size is fatter than the requested size,</span>
            <span class="c"># then trim each row from the right to be the new size.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">display</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[:</span><span class="n">cols</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[:</span><span class="n">cols</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span>

    <span class="k">def</span> <span class="nf">_shift_in</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_charset</span> <span class="o">=</span> <span class="s">&quot;g0&quot;</span>

    <span class="k">def</span> <span class="nf">_shift_out</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_charset</span> <span class="o">=</span> <span class="s">&quot;g1&quot;</span>

    <span class="k">def</span> <span class="nf">_bell</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">_charset_g0</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">cs</span> <span class="o">==</span> <span class="s">&#39;0&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">g0</span> <span class="o">=</span> <span class="n">graphics</span><span class="o">.</span><span class="n">dsg</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># TODO: Officially support UK/US/intl8 charsets</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">g0</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">_charset_g1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">cs</span> <span class="o">==</span> <span class="s">&#39;0&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">g1</span> <span class="o">=</span> <span class="n">graphics</span><span class="o">.</span><span class="n">dsg</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># TODO: Officially support UK/US/intl8 charsets</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">g1</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">_print</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">char</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Print a character at the current cursor position and advance the</span>
<span class="sd">        cursor.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># Don&#39;t make bugs where we try to print a screen. </span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">char</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c"># Python 3</span>
                <span class="n">char</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decoder</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="n">char</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="c"># Python 2.x</span>
                <span class="n">char</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decoder</span><span class="p">(</span><span class="n">char</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">except</span> <span class="ne">UnicodeDecodeError</span><span class="p">:</span>
            <span class="n">char</span> <span class="o">=</span> <span class="s">&quot;?&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_charset</span> <span class="o">==</span> <span class="s">&quot;g0&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">g0</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">char</span> <span class="o">=</span> <span class="n">char</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">g0</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_charset</span> <span class="o">==</span> <span class="s">&quot;g1&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">g1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">char</span> <span class="o">=</span> <span class="n">char</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">g1</span><span class="p">)</span>

        <span class="n">row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">]</span> <span class="o">+</span> <span class="n">char</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>

        <span class="n">attrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">attrs</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cursor_attributes</span><span class="p">]</span> <span class="o">+</span> \
                <span class="n">attrs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="c"># If this was the last column in a row, move the cursor to the</span>
            <span class="c"># next row.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_linefeed</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_carriage_return</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Move the cursor to the beginning of the current row.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_index</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Move the cursor down one row in the same column. If the cursor is at </span>
<span class="sd">        the last row, create a new row at the bottom.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="c"># If the cursor is currently on the last row, then spawn another</span>
            <span class="c"># and scroll down (removing the top row).</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">display</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="p">[</span><span class="s">u&quot; &quot;</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># If the cursor is anywhere else, then just move it to the </span>
            <span class="c"># next line.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">_reverse_index</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Move the cursor up one row in the same column. If the cursor is at the</span>
<span class="sd">        first row, create a new row at the top.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c"># If the cursor is currently at the first row, then scroll the</span>
            <span class="c"># screen up.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">display</span> <span class="o">=</span> <span class="p">[</span><span class="s">u&quot; &quot;</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># If the cursor is anywhere other than the first row than just move</span>
            <span class="c"># it up by one row.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">-=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">_linefeed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Performs an index and then a carriage return.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_index</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_reverse_linefeed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Performs a reverse index and then a carriage return.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_reverse_index</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_next_tab_stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the x value of the next available tabstop or the x value of the </span>
<span class="sd">        margin if there are no more tabstops.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">stop</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tabstops</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">stop</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">stop</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">_tab</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Move to the next tab space, or the end of the screen if there aren&#39;t</span>
<span class="sd">        anymore left.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_next_tab_stop</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_backspace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Move cursor to the left one or keep it in it&#39;s position if it&#39;s at</span>
<span class="sd">        the beginning of the line already.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_save_cursor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Push the current cursor position onto the stack.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cursor_save_stack</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_restore_cursor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the current cursor position to whatever cursor is on top of the </span>
<span class="sd">        stack.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cursor_save_stack</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor_save_stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_insert_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Inserts lines at line with cursor. Lines displayed below cursor move </span>
<span class="sd">        down. Lines moved past the bottom margin are lost. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">trimmed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> \
                  <span class="p">[</span><span class="s">u&quot; &quot;</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">*</span> <span class="n">count</span> <span class="o">+</span> \
                  <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">+</span><span class="n">count</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span> <span class="o">=</span> <span class="n">trimmed</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

    <span class="k">def</span> <span class="nf">_delete_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Deletes count lines, starting at line with cursor. As lines are </span>
<span class="sd">        deleted, lines displayed below cursor move up. Lines added to bottom of</span>
<span class="sd">        screen have spaces with same character attributes as last line moved </span>
<span class="sd">        up.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">]</span> <span class="o">+</span> \
                       <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s">u&quot; &quot;</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">*</span> <span class="n">count</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">]</span> <span class="o">+</span> \
                       <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>
        <span class="n">last_attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">count</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">copy</span><span class="p">(</span><span class="n">last_attributes</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_delete_character</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Deletes count characters, starting with the character at cursor</span>
<span class="sd">        position. When a character is deleted, all characters to the right </span>
<span class="sd">        of cursor move left.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># First resize the text display</span>
        <span class="n">row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">]</span>
        <span class="n">count</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
        <span class="n">row</span> <span class="o">=</span> <span class="n">row</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">]</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">+</span><span class="n">count</span><span class="p">:]</span> <span class="o">+</span> <span class="s">u&quot; &quot;</span> <span class="o">*</span> <span class="n">count</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span>

        <span class="c"># Then resize the attribute array too</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">]</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="n">attrs</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">]</span> <span class="o">+</span> <span class="n">attrs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">+</span><span class="n">count</span><span class="p">:]</span> <span class="o">+</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">default_attributes</span><span class="p">]</span> <span class="o">*</span> <span class="n">count</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">attrs</span>

    <span class="k">def</span> <span class="nf">_erase_in_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">type_of</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Erases the row in a specific way, depending on the type_of.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">]</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">type_of</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c"># Erase from the cursor to the end of line, including the cursor</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">row</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">]</span> <span class="o">+</span> <span class="s">u&quot; &quot;</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
            <span class="n">attrs</span> <span class="o">=</span> <span class="n">attrs</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">default_attributes</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">type_of</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c"># Erase from the beginning of the line to the cursor, including it</span>
            <span class="n">row</span> <span class="o">=</span> <span class="s">u&quot; &quot;</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>
            <span class="n">attrs</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">default_attributes</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">attrs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">elif</span> <span class="n">type_of</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="c"># Erase the entire line.</span>
            <span class="n">row</span> <span class="o">=</span> <span class="s">u&quot; &quot;</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">attrs</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">default_attributes</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">attrs</span>

    <span class="k">def</span> <span class="nf">_erase_in_display</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">type_of</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">type_of</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c"># Erase from cursor to the end of the display, including the </span>
            <span class="c"># cursor.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">display</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">]</span> <span class="o">+</span> \
                    <span class="p">[</span><span class="s">u&quot; &quot;</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">]</span> <span class="o">+</span> \
                    <span class="p">[[</span><span class="bp">self</span><span class="o">.</span><span class="n">default_attributes</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">type_of</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c"># Erase from the beginning of the display to the cursor, including </span>
            <span class="c"># it.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">display</span> <span class="o">=</span> <span class="p">[</span><span class="s">u&quot; &quot;</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">self</span><span class="o">.</span><span class="n">default_attributes</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">elif</span> <span class="n">type_of</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="c"># Erase the whole display.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">display</span> <span class="o">=</span> <span class="p">[</span><span class="s">u&quot; &quot;</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">self</span><span class="o">.</span><span class="n">default_attributes</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_set_insert_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">irm</span> <span class="o">=</span> <span class="s">&quot;insert&quot;</span>

    <span class="k">def</span> <span class="nf">_set_replace_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">irm</span> <span class="o">=</span> <span class="s">&quot;replace&quot;</span>

    <span class="k">def</span> <span class="nf">_set_tab_stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets a horizontal tab stop at cursor position.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tabstops</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_clear_tab_stop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">type_of</span><span class="o">=</span><span class="mh">0x33</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">type_of</span> <span class="o">==</span> <span class="mh">0x30</span><span class="p">:</span>
            <span class="c"># Clears a horizontal tab stop at cursor position.</span>
            <span class="k">try</span><span class="p">:</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">tabstops</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> 
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span> 
                <span class="c"># If there is no tabstop at the current position, then just do</span>
                <span class="c"># nothing.</span>
                <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">type_of</span> <span class="o">==</span> <span class="mh">0x33</span><span class="p">:</span>
            <span class="c"># Clears all horizontal tab stops</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tabstops</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">_cursor_up</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Moves cursor up count lines in same column. Cursor stops at top </span>
<span class="sd">        margin.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">count</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cursor_down</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Moves cursor down count lines in same column. Cursor stops at bottom </span>
<span class="sd">        margin.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">count</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cursor_back</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Moves cursor left count columns. Cursor stops at left margin.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">count</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cursor_forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Moves cursor right count columns. Cursor stops at right margin.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">count</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cursor_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the cursor to a specific row and column. </span>

<span class="sd">        Obnoxiously row/column is 1 based, instead of zero based, so we need </span>
<span class="sd">        to compensate. I know I&#39;ve created bugs in here somehow.</span>
<span class="sd">        Confoundingly, inputs of 0 are still acceptable, and should move to</span>
<span class="sd">        the beginning of the row/column as if they were 1. *sigh*</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">row</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> 
            <span class="n">row</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">column</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> 
            <span class="n">column</span> <span class="o">=</span> <span class="mi">1</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">row</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">column</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_home</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the cursor to (0, 0)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_remove_text_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
        <span class="n">current</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cursor_attributes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">current</span><span class="p">:</span>
            <span class="n">current</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">current</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor_attributes</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

    <span class="k">def</span> <span class="nf">_add_text_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
        <span class="n">current</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cursor_attributes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">current</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor_attributes</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">return</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">current</span><span class="p">),</span> <span class="n">attrs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">attrs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> 

    <span class="k">def</span> <span class="nf">_text_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given a text attribute, set the current cursor appropriately.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">attr</span> <span class="o">=</span> <span class="n">text</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">attr</span> <span class="o">==</span> <span class="s">&quot;reset&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cursor_attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_attributes</span>
        <span class="k">elif</span> <span class="n">attr</span> <span class="o">==</span> <span class="s">&quot;underline-off&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cursor_attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remove_text_attr</span><span class="p">(</span><span class="s">&quot;underline&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">attr</span> <span class="o">==</span> <span class="s">&quot;blink-off&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cursor_attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remove_text_attr</span><span class="p">(</span><span class="s">&quot;blink&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">attr</span> <span class="o">==</span> <span class="s">&quot;reverse-off&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cursor_attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remove_text_attr</span><span class="p">(</span><span class="s">&quot;reverse&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cursor_attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_text_attr</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_color_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ground</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given a color attribute, set the current cursor appropriately.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">attr</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">ground</span><span class="p">][</span><span class="n">attr</span><span class="p">]</span> 
        <span class="n">attrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor_attributes</span>
        <span class="k">if</span> <span class="n">ground</span> <span class="o">==</span> <span class="s">&quot;foreground&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cursor_attributes</span> <span class="o">=</span> <span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">attr</span><span class="p">,</span> <span class="n">attrs</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">ground</span> <span class="o">==</span> <span class="s">&quot;background&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cursor_attributes</span> <span class="o">=</span> <span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">attrs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">attr</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given some text attribute, set the current cursor attributes </span>
<span class="sd">        appropriately.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">text</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_text_attr</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">colors</span><span class="p">[</span><span class="s">&quot;foreground&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_color_attr</span><span class="p">(</span><span class="s">&quot;foreground&quot;</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">colors</span><span class="p">[</span><span class="s">&quot;background&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_color_attr</span><span class="p">(</span><span class="s">&quot;background&quot;</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_select_graphic_rendition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">attrs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the current text attribute.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">attrs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c"># No arguments means that we&#39;re really trying to do a reset.</span>
            <span class="n">attrs</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_attr</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>
</pre></div>

  </div>

  </header>

  <section id="section-items">
    <h2 class="section-title" id="header-variables">Module variables</h2>
      <div class="item">
      <p id="vt102.colors" class="name">var <span class="ident">colors</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="vt102.text" class="name">var <span class="ident">text</span></p>
      
  
  <div class="source_cont">
</div>

      </div>


    <h2 class="section-title" id="header-classes">Classes</h2>
      
      <div class="item">
      <p id="vt102.StreamProcessError" class="name">class <span class="ident">StreamProcessError</span></p>
      
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-vt102.StreamProcessError', this);">Show source &equiv;</a></p>
  <div id="source-vt102.StreamProcessError" class="source">
    <div class="codehilite"><pre><span class="k">class</span> <span class="nc">StreamProcessError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#vt102.StreamProcessError">StreamProcessError</a></li>
          <li>builtins.Exception</li>
          <li>builtins.BaseException</li>
          <li>builtins.object</li>
          </ul>
          <h3>Class variables</h3>
            <div class="item">
            <p id="vt102.StreamProcessError.args" class="name">var <span class="ident">args</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
      </div>
      </div>
      
      <div class="item">
      <p id="vt102.screen" class="name">class <span class="ident">screen</span></p>
      
  
    <div class="desc"><p>A screen is an in memory buffer of strings that represents the screen
display of the terminal. It can be instantiated on it's own and given 
explicit commands, or it can be attached to a stream and will respond to
events.</p>
<p>The screen buffer can be accessed through the screen's <code>display</code> property.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-vt102.screen', this);">Show source &equiv;</a></p>
  <div id="source-vt102.screen" class="source">
    <div class="codehilite"><pre><span class="k">class</span> <span class="nc">screen</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A screen is an in memory buffer of strings that represents the screen</span>
<span class="sd">    display of the terminal. It can be instantiated on it&#39;s own and given </span>
<span class="sd">    explicit commands, or it can be attached to a stream and will respond to</span>
<span class="sd">    events.</span>

<span class="sd">    The screen buffer can be accessed through the screen&#39;s `display` property.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c">#: Default colors and styling. The value of this attribute should</span>
    <span class="c">#: always be immutable, since shallow copies are made when resizing /</span>
    <span class="c">#: applying / deleting / printing.</span>
    <span class="c">#:</span>
    <span class="c">#: Attributes are represented by a three-tuple that consists of the</span>
    <span class="c">#: following:</span>
    <span class="c">#:</span>
    <span class="c">#:     1. A tuple of all the text attributes: `bold`, `underline`, etc</span>
    <span class="c">#:     2. The foreground color as a string, see</span>
    <span class="c">#:        :attr:`vt102.graphics.colors`</span>
    <span class="c">#:     3. The background color as a string, see</span>
    <span class="c">#:        :attr:`vt102.graphics.colors`</span>
    <span class="n">default_attributes</span> <span class="o">=</span> <span class="p">(),</span> <span class="s">&quot;default&quot;</span><span class="p">,</span> <span class="s">&quot;default&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">&quot;utf-8&quot;</span><span class="p">):</span>
        <span class="n">rows</span><span class="p">,</span> <span class="n">cols</span> <span class="o">=</span> <span class="n">shape</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span> <span class="o">=</span> <span class="n">encoding</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">decoder</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">getdecoder</span><span class="p">(</span><span class="n">encoding</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">irm</span> <span class="o">=</span> <span class="s">&quot;insert&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tabstops</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">g0</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">g1</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_charset</span> <span class="o">=</span> <span class="s">&quot;g0&quot;</span> 

        <span class="bp">self</span><span class="o">.</span><span class="n">cursor_save_stack</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c"># Initialize the screen to completely empty.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span> <span class="o">=</span> <span class="p">[</span><span class="s">u&quot; &quot;</span> <span class="o">*</span> <span class="n">cols</span><span class="p">]</span> <span class="o">*</span> <span class="n">rows</span>

        <span class="c"># Initialize the attributes to completely empty, but the same size as</span>
        <span class="c"># the screen.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">self</span><span class="o">.</span><span class="n">default_attributes</span><span class="p">]</span> <span class="o">*</span> <span class="n">cols</span><span class="p">]</span> <span class="o">*</span> <span class="n">rows</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cursor_attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_attributes</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;&quot;</span><span class="si">%s</span><span class="s">&quot;&#39;</span> <span class="o">%</span> <span class="n">l</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">]</span>

        <span class="k">return</span> <span class="s">&quot;[&quot;</span> <span class="o">+</span> <span class="s">&quot;,</span><span class="se">\n</span><span class="s"> &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;]&quot;</span>

    <span class="k">def</span> <span class="nf">attach</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attach this screen to a events that processes commands and dispatches </span>
<span class="sd">        events. Sets up the appropriate event handlers so that the screen will</span>
<span class="sd">        update itself automatically as the events processes data.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">events</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">events</span><span class="o">.</span><span class="n">add_event_listener</span><span class="p">(</span><span class="s">&quot;print&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">)</span>
            <span class="n">events</span><span class="o">.</span><span class="n">add_event_listener</span><span class="p">(</span><span class="s">&quot;backspace&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_backspace</span><span class="p">)</span>
            <span class="n">events</span><span class="o">.</span><span class="n">add_event_listener</span><span class="p">(</span><span class="s">&quot;tab&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tab</span><span class="p">)</span>
            <span class="n">events</span><span class="o">.</span><span class="n">add_event_listener</span><span class="p">(</span><span class="s">&quot;linefeed&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_linefeed</span><span class="p">)</span>
            <span class="n">events</span><span class="o">.</span><span class="n">add_event_listener</span><span class="p">(</span><span class="s">&quot;reverse-linefeed&quot;</span><span class="p">,</span> 
                                      <span class="bp">self</span><span class="o">.</span><span class="n">_reverse_linefeed</span><span class="p">)</span>
            <span class="n">events</span><span class="o">.</span><span class="n">add_event_listener</span><span class="p">(</span><span class="s">&quot;carriage-return&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_carriage_return</span><span class="p">)</span>
            <span class="n">events</span><span class="o">.</span><span class="n">add_event_listener</span><span class="p">(</span><span class="s">&quot;index&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index</span><span class="p">)</span>
            <span class="n">events</span><span class="o">.</span><span class="n">add_event_listener</span><span class="p">(</span><span class="s">&quot;reverse-index&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reverse_index</span><span class="p">)</span>
            <span class="n">events</span><span class="o">.</span><span class="n">add_event_listener</span><span class="p">(</span><span class="s">&quot;store-cursor&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_save_cursor</span><span class="p">)</span>
            <span class="n">events</span><span class="o">.</span><span class="n">add_event_listener</span><span class="p">(</span><span class="s">&quot;restore-cursor&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_restore_cursor</span><span class="p">)</span>
            <span class="n">events</span><span class="o">.</span><span class="n">add_event_listener</span><span class="p">(</span><span class="s">&quot;cursor-up&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cursor_up</span><span class="p">)</span>
            <span class="n">events</span><span class="o">.</span><span class="n">add_event_listener</span><span class="p">(</span><span class="s">&quot;cursor-down&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cursor_down</span><span class="p">)</span>
            <span class="n">events</span><span class="o">.</span><span class="n">add_event_listener</span><span class="p">(</span><span class="s">&quot;cursor-right&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cursor_forward</span><span class="p">)</span>
            <span class="n">events</span><span class="o">.</span><span class="n">add_event_listener</span><span class="p">(</span><span class="s">&quot;cursor-left&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cursor_back</span><span class="p">)</span>
            <span class="n">events</span><span class="o">.</span><span class="n">add_event_listener</span><span class="p">(</span><span class="s">&quot;cursor-move&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cursor_position</span><span class="p">)</span>
            <span class="n">events</span><span class="o">.</span><span class="n">add_event_listener</span><span class="p">(</span><span class="s">&quot;erase-in-line&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_erase_in_line</span><span class="p">)</span>
            <span class="n">events</span><span class="o">.</span><span class="n">add_event_listener</span><span class="p">(</span><span class="s">&quot;erase-in-display&quot;</span><span class="p">,</span> 
                                      <span class="bp">self</span><span class="o">.</span><span class="n">_erase_in_display</span><span class="p">)</span>
            <span class="n">events</span><span class="o">.</span><span class="n">add_event_listener</span><span class="p">(</span><span class="s">&quot;delete-characters&quot;</span><span class="p">,</span> 
                                      <span class="bp">self</span><span class="o">.</span><span class="n">_delete_character</span><span class="p">)</span>
            <span class="n">events</span><span class="o">.</span><span class="n">add_event_listener</span><span class="p">(</span><span class="s">&quot;insert-lines&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_insert_line</span><span class="p">)</span>
            <span class="n">events</span><span class="o">.</span><span class="n">add_event_listener</span><span class="p">(</span><span class="s">&quot;delete-lines&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delete_line</span><span class="p">)</span>
            <span class="n">events</span><span class="o">.</span><span class="n">add_event_listener</span><span class="p">(</span><span class="s">&quot;select-graphic-rendition&quot;</span><span class="p">,</span>
                                      <span class="bp">self</span><span class="o">.</span><span class="n">_select_graphic_rendition</span><span class="p">)</span>
            <span class="n">events</span><span class="o">.</span><span class="n">add_event_listener</span><span class="p">(</span><span class="s">&quot;charset-g0&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_charset_g0</span><span class="p">)</span>
            <span class="n">events</span><span class="o">.</span><span class="n">add_event_listener</span><span class="p">(</span><span class="s">&quot;charset-g1&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_charset_g1</span><span class="p">)</span>
            <span class="n">events</span><span class="o">.</span><span class="n">add_event_listener</span><span class="p">(</span><span class="s">&quot;shift-in&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shift_in</span><span class="p">)</span>
            <span class="n">events</span><span class="o">.</span><span class="n">add_event_listener</span><span class="p">(</span><span class="s">&quot;shift-out&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shift_out</span><span class="p">)</span>
            <span class="n">events</span><span class="o">.</span><span class="n">add_event_listener</span><span class="p">(</span><span class="s">&quot;bell&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bell</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">cursor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The current location of the cursor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">resize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shape</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Resize the screen. If the requested screen size has more rows than the</span>
<span class="sd">        existing screen, rows will be added at the bottom. If the requested</span>
<span class="sd">        size has less rows than the existing screen rows will be clipped at the</span>
<span class="sd">        top of the screen.</span>

<span class="sd">        Similarly if the existing screen has less columns than the requested </span>
<span class="sd">        size, columns will be added at the right, and it it has more, columns </span>
<span class="sd">        will be clipped at the right.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rows</span><span class="p">,</span> <span class="n">cols</span> <span class="o">=</span> <span class="n">shape</span>

        <span class="c"># Honestly though, you can&#39;t trust anyone these days...</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">rows</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">cols</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>

        <span class="c"># First resize the rows</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">rows</span><span class="p">:</span>
            <span class="c"># If the current display size is shorter than the requested screen</span>
            <span class="c"># size, then add rows to the bottom. Note that the old column size</span>
            <span class="c"># is used here so these new rows will get expanded/contracted as</span>
            <span class="c"># necessary by the column resize when it happens next.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">display</span> <span class="o">+=</span> <span class="p">[</span><span class="s">u&quot; &quot;</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">*</span> <span class="p">(</span><span class="n">rows</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span> <span class="o">+=</span> <span class="p">[[</span><span class="bp">self</span><span class="o">.</span><span class="n">default_attributes</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">*</span> \
                    <span class="p">(</span><span class="n">rows</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">rows</span><span class="p">:</span>
            <span class="c"># If the current display size is taller than the requested display,</span>
            <span class="c"># then take rows off the top.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">display</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">rows</span><span class="p">:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">rows</span><span class="p">:]</span>

        <span class="c"># Next, of course, resize the columns.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">cols</span><span class="p">:</span>
            <span class="c"># If the current display size is thinner than the requested size,</span>
            <span class="c"># expand each row to be the new size.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">display</span> <span class="o">=</span> \
                <span class="p">[</span><span class="n">row</span> <span class="o">+</span> <span class="p">(</span><span class="s">u&quot; &quot;</span> <span class="o">*</span> <span class="p">(</span><span class="n">cols</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span> <span class="o">=</span> \
                <span class="p">[</span><span class="n">row</span> <span class="o">+</span> <span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">default_attributes</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">cols</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">]</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">cols</span><span class="p">:</span>
            <span class="c"># If the current display size is fatter than the requested size,</span>
            <span class="c"># then trim each row from the right to be the new size.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">display</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[:</span><span class="n">cols</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[:</span><span class="n">cols</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span>

    <span class="k">def</span> <span class="nf">_shift_in</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_charset</span> <span class="o">=</span> <span class="s">&quot;g0&quot;</span>

    <span class="k">def</span> <span class="nf">_shift_out</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_charset</span> <span class="o">=</span> <span class="s">&quot;g1&quot;</span>

    <span class="k">def</span> <span class="nf">_bell</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">_charset_g0</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">cs</span> <span class="o">==</span> <span class="s">&#39;0&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">g0</span> <span class="o">=</span> <span class="n">graphics</span><span class="o">.</span><span class="n">dsg</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># TODO: Officially support UK/US/intl8 charsets</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">g0</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">_charset_g1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">cs</span> <span class="o">==</span> <span class="s">&#39;0&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">g1</span> <span class="o">=</span> <span class="n">graphics</span><span class="o">.</span><span class="n">dsg</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># TODO: Officially support UK/US/intl8 charsets</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">g1</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">_print</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">char</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Print a character at the current cursor position and advance the</span>
<span class="sd">        cursor.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># Don&#39;t make bugs where we try to print a screen. </span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">char</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c"># Python 3</span>
                <span class="n">char</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decoder</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="n">char</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="c"># Python 2.x</span>
                <span class="n">char</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decoder</span><span class="p">(</span><span class="n">char</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">except</span> <span class="ne">UnicodeDecodeError</span><span class="p">:</span>
            <span class="n">char</span> <span class="o">=</span> <span class="s">&quot;?&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_charset</span> <span class="o">==</span> <span class="s">&quot;g0&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">g0</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">char</span> <span class="o">=</span> <span class="n">char</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">g0</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_charset</span> <span class="o">==</span> <span class="s">&quot;g1&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">g1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">char</span> <span class="o">=</span> <span class="n">char</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">g1</span><span class="p">)</span>

        <span class="n">row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">]</span> <span class="o">+</span> <span class="n">char</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>

        <span class="n">attrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">attrs</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cursor_attributes</span><span class="p">]</span> <span class="o">+</span> \
                <span class="n">attrs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="c"># If this was the last column in a row, move the cursor to the</span>
            <span class="c"># next row.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_linefeed</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_carriage_return</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Move the cursor to the beginning of the current row.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_index</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Move the cursor down one row in the same column. If the cursor is at </span>
<span class="sd">        the last row, create a new row at the bottom.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="c"># If the cursor is currently on the last row, then spawn another</span>
            <span class="c"># and scroll down (removing the top row).</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">display</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="p">[</span><span class="s">u&quot; &quot;</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># If the cursor is anywhere else, then just move it to the </span>
            <span class="c"># next line.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">_reverse_index</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Move the cursor up one row in the same column. If the cursor is at the</span>
<span class="sd">        first row, create a new row at the top.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c"># If the cursor is currently at the first row, then scroll the</span>
            <span class="c"># screen up.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">display</span> <span class="o">=</span> <span class="p">[</span><span class="s">u&quot; &quot;</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># If the cursor is anywhere other than the first row than just move</span>
            <span class="c"># it up by one row.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">-=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">_linefeed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Performs an index and then a carriage return.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_index</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_reverse_linefeed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Performs a reverse index and then a carriage return.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_reverse_index</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_next_tab_stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the x value of the next available tabstop or the x value of the </span>
<span class="sd">        margin if there are no more tabstops.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">stop</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tabstops</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">stop</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">stop</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">_tab</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Move to the next tab space, or the end of the screen if there aren&#39;t</span>
<span class="sd">        anymore left.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_next_tab_stop</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_backspace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Move cursor to the left one or keep it in it&#39;s position if it&#39;s at</span>
<span class="sd">        the beginning of the line already.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_save_cursor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Push the current cursor position onto the stack.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cursor_save_stack</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_restore_cursor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the current cursor position to whatever cursor is on top of the </span>
<span class="sd">        stack.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cursor_save_stack</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor_save_stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_insert_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Inserts lines at line with cursor. Lines displayed below cursor move </span>
<span class="sd">        down. Lines moved past the bottom margin are lost. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">trimmed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> \
                  <span class="p">[</span><span class="s">u&quot; &quot;</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">*</span> <span class="n">count</span> <span class="o">+</span> \
                  <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">+</span><span class="n">count</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span> <span class="o">=</span> <span class="n">trimmed</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

    <span class="k">def</span> <span class="nf">_delete_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Deletes count lines, starting at line with cursor. As lines are </span>
<span class="sd">        deleted, lines displayed below cursor move up. Lines added to bottom of</span>
<span class="sd">        screen have spaces with same character attributes as last line moved </span>
<span class="sd">        up.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">]</span> <span class="o">+</span> \
                       <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s">u&quot; &quot;</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">*</span> <span class="n">count</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">]</span> <span class="o">+</span> \
                       <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>
        <span class="n">last_attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">count</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">copy</span><span class="p">(</span><span class="n">last_attributes</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_delete_character</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Deletes count characters, starting with the character at cursor</span>
<span class="sd">        position. When a character is deleted, all characters to the right </span>
<span class="sd">        of cursor move left.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># First resize the text display</span>
        <span class="n">row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">]</span>
        <span class="n">count</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
        <span class="n">row</span> <span class="o">=</span> <span class="n">row</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">]</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">+</span><span class="n">count</span><span class="p">:]</span> <span class="o">+</span> <span class="s">u&quot; &quot;</span> <span class="o">*</span> <span class="n">count</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span>

        <span class="c"># Then resize the attribute array too</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">]</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="n">attrs</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">]</span> <span class="o">+</span> <span class="n">attrs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">+</span><span class="n">count</span><span class="p">:]</span> <span class="o">+</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">default_attributes</span><span class="p">]</span> <span class="o">*</span> <span class="n">count</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">attrs</span>

    <span class="k">def</span> <span class="nf">_erase_in_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">type_of</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Erases the row in a specific way, depending on the type_of.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">]</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">type_of</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c"># Erase from the cursor to the end of line, including the cursor</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">row</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">]</span> <span class="o">+</span> <span class="s">u&quot; &quot;</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
            <span class="n">attrs</span> <span class="o">=</span> <span class="n">attrs</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">default_attributes</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">type_of</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c"># Erase from the beginning of the line to the cursor, including it</span>
            <span class="n">row</span> <span class="o">=</span> <span class="s">u&quot; &quot;</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>
            <span class="n">attrs</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">default_attributes</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">attrs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">elif</span> <span class="n">type_of</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="c"># Erase the entire line.</span>
            <span class="n">row</span> <span class="o">=</span> <span class="s">u&quot; &quot;</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">attrs</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">default_attributes</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">attrs</span>

    <span class="k">def</span> <span class="nf">_erase_in_display</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">type_of</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">type_of</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c"># Erase from cursor to the end of the display, including the </span>
            <span class="c"># cursor.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">display</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">]</span> <span class="o">+</span> \
                    <span class="p">[</span><span class="s">u&quot; &quot;</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">]</span> <span class="o">+</span> \
                    <span class="p">[[</span><span class="bp">self</span><span class="o">.</span><span class="n">default_attributes</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">type_of</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c"># Erase from the beginning of the display to the cursor, including </span>
            <span class="c"># it.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">display</span> <span class="o">=</span> <span class="p">[</span><span class="s">u&quot; &quot;</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">self</span><span class="o">.</span><span class="n">default_attributes</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">elif</span> <span class="n">type_of</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="c"># Erase the whole display.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">display</span> <span class="o">=</span> <span class="p">[</span><span class="s">u&quot; &quot;</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">self</span><span class="o">.</span><span class="n">default_attributes</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_set_insert_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">irm</span> <span class="o">=</span> <span class="s">&quot;insert&quot;</span>

    <span class="k">def</span> <span class="nf">_set_replace_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">irm</span> <span class="o">=</span> <span class="s">&quot;replace&quot;</span>

    <span class="k">def</span> <span class="nf">_set_tab_stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets a horizontal tab stop at cursor position.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tabstops</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_clear_tab_stop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">type_of</span><span class="o">=</span><span class="mh">0x33</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">type_of</span> <span class="o">==</span> <span class="mh">0x30</span><span class="p">:</span>
            <span class="c"># Clears a horizontal tab stop at cursor position.</span>
            <span class="k">try</span><span class="p">:</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">tabstops</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> 
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span> 
                <span class="c"># If there is no tabstop at the current position, then just do</span>
                <span class="c"># nothing.</span>
                <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">type_of</span> <span class="o">==</span> <span class="mh">0x33</span><span class="p">:</span>
            <span class="c"># Clears all horizontal tab stops</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tabstops</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">_cursor_up</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Moves cursor up count lines in same column. Cursor stops at top </span>
<span class="sd">        margin.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">count</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cursor_down</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Moves cursor down count lines in same column. Cursor stops at bottom </span>
<span class="sd">        margin.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">count</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cursor_back</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Moves cursor left count columns. Cursor stops at left margin.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">count</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cursor_forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Moves cursor right count columns. Cursor stops at right margin.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">count</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cursor_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the cursor to a specific row and column. </span>

<span class="sd">        Obnoxiously row/column is 1 based, instead of zero based, so we need </span>
<span class="sd">        to compensate. I know I&#39;ve created bugs in here somehow.</span>
<span class="sd">        Confoundingly, inputs of 0 are still acceptable, and should move to</span>
<span class="sd">        the beginning of the row/column as if they were 1. *sigh*</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">row</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> 
            <span class="n">row</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">column</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> 
            <span class="n">column</span> <span class="o">=</span> <span class="mi">1</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">row</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">column</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_home</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the cursor to (0, 0)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_remove_text_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
        <span class="n">current</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cursor_attributes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">current</span><span class="p">:</span>
            <span class="n">current</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">current</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor_attributes</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

    <span class="k">def</span> <span class="nf">_add_text_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
        <span class="n">current</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cursor_attributes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">current</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor_attributes</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">return</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">current</span><span class="p">),</span> <span class="n">attrs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">attrs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> 

    <span class="k">def</span> <span class="nf">_text_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given a text attribute, set the current cursor appropriately.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">attr</span> <span class="o">=</span> <span class="n">text</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">attr</span> <span class="o">==</span> <span class="s">&quot;reset&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cursor_attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_attributes</span>
        <span class="k">elif</span> <span class="n">attr</span> <span class="o">==</span> <span class="s">&quot;underline-off&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cursor_attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remove_text_attr</span><span class="p">(</span><span class="s">&quot;underline&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">attr</span> <span class="o">==</span> <span class="s">&quot;blink-off&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cursor_attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remove_text_attr</span><span class="p">(</span><span class="s">&quot;blink&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">attr</span> <span class="o">==</span> <span class="s">&quot;reverse-off&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cursor_attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remove_text_attr</span><span class="p">(</span><span class="s">&quot;reverse&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cursor_attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_text_attr</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_color_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ground</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given a color attribute, set the current cursor appropriately.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">attr</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">ground</span><span class="p">][</span><span class="n">attr</span><span class="p">]</span> 
        <span class="n">attrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor_attributes</span>
        <span class="k">if</span> <span class="n">ground</span> <span class="o">==</span> <span class="s">&quot;foreground&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cursor_attributes</span> <span class="o">=</span> <span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">attr</span><span class="p">,</span> <span class="n">attrs</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">ground</span> <span class="o">==</span> <span class="s">&quot;background&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cursor_attributes</span> <span class="o">=</span> <span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">attrs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">attr</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given some text attribute, set the current cursor attributes </span>
<span class="sd">        appropriately.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">text</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_text_attr</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">colors</span><span class="p">[</span><span class="s">&quot;foreground&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_color_attr</span><span class="p">(</span><span class="s">&quot;foreground&quot;</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">colors</span><span class="p">[</span><span class="s">&quot;background&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_color_attr</span><span class="p">(</span><span class="s">&quot;background&quot;</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_select_graphic_rendition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">attrs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the current text attribute.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">attrs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c"># No arguments means that we&#39;re really trying to do a reset.</span>
            <span class="n">attrs</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_attr</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#vt102.screen">screen</a></li>
          <li>builtins.object</li>
          </ul>
          <h3>Class variables</h3>
            <div class="item">
            <p id="vt102.screen.default_attributes" class="name">var <span class="ident">default_attributes</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
          <h3>Static methods</h3>
            
  <div class="item">
    <div class="name def" id="vt102.screen.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, shape, encoding=&#39;utf-8&#39;)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-vt102.screen.__init__', this);">Show source &equiv;</a></p>
  <div id="source-vt102.screen.__init__" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">&quot;utf-8&quot;</span><span class="p">):</span>
    <span class="n">rows</span><span class="p">,</span> <span class="n">cols</span> <span class="o">=</span> <span class="n">shape</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span> <span class="o">=</span> <span class="n">encoding</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">decoder</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">getdecoder</span><span class="p">(</span><span class="n">encoding</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">irm</span> <span class="o">=</span> <span class="s">&quot;insert&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tabstops</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">g0</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">g1</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">current_charset</span> <span class="o">=</span> <span class="s">&quot;g0&quot;</span> 
    <span class="bp">self</span><span class="o">.</span><span class="n">cursor_save_stack</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c"># Initialize the screen to completely empty.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">display</span> <span class="o">=</span> <span class="p">[</span><span class="s">u&quot; &quot;</span> <span class="o">*</span> <span class="n">cols</span><span class="p">]</span> <span class="o">*</span> <span class="n">rows</span>
    <span class="c"># Initialize the attributes to completely empty, but the same size as</span>
    <span class="c"># the screen.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">self</span><span class="o">.</span><span class="n">default_attributes</span><span class="p">]</span> <span class="o">*</span> <span class="n">cols</span><span class="p">]</span> <span class="o">*</span> <span class="n">rows</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">cursor_attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_attributes</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="vt102.screen.attach">
    <p>def <span class="ident">attach</span>(</p><p>self, events)</p>
    </div>
    

    
  
    <div class="desc"><p>Attach this screen to a events that processes commands and dispatches 
events. Sets up the appropriate event handlers so that the screen will
update itself automatically as the events processes data.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-vt102.screen.attach', this);">Show source &equiv;</a></p>
  <div id="source-vt102.screen.attach" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">attach</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attach this screen to a events that processes commands and dispatches </span>
<span class="sd">    events. Sets up the appropriate event handlers so that the screen will</span>
<span class="sd">    update itself automatically as the events processes data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">events</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">events</span><span class="o">.</span><span class="n">add_event_listener</span><span class="p">(</span><span class="s">&quot;print&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">)</span>
        <span class="n">events</span><span class="o">.</span><span class="n">add_event_listener</span><span class="p">(</span><span class="s">&quot;backspace&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_backspace</span><span class="p">)</span>
        <span class="n">events</span><span class="o">.</span><span class="n">add_event_listener</span><span class="p">(</span><span class="s">&quot;tab&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tab</span><span class="p">)</span>
        <span class="n">events</span><span class="o">.</span><span class="n">add_event_listener</span><span class="p">(</span><span class="s">&quot;linefeed&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_linefeed</span><span class="p">)</span>
        <span class="n">events</span><span class="o">.</span><span class="n">add_event_listener</span><span class="p">(</span><span class="s">&quot;reverse-linefeed&quot;</span><span class="p">,</span> 
                                  <span class="bp">self</span><span class="o">.</span><span class="n">_reverse_linefeed</span><span class="p">)</span>
        <span class="n">events</span><span class="o">.</span><span class="n">add_event_listener</span><span class="p">(</span><span class="s">&quot;carriage-return&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_carriage_return</span><span class="p">)</span>
        <span class="n">events</span><span class="o">.</span><span class="n">add_event_listener</span><span class="p">(</span><span class="s">&quot;index&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index</span><span class="p">)</span>
        <span class="n">events</span><span class="o">.</span><span class="n">add_event_listener</span><span class="p">(</span><span class="s">&quot;reverse-index&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reverse_index</span><span class="p">)</span>
        <span class="n">events</span><span class="o">.</span><span class="n">add_event_listener</span><span class="p">(</span><span class="s">&quot;store-cursor&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_save_cursor</span><span class="p">)</span>
        <span class="n">events</span><span class="o">.</span><span class="n">add_event_listener</span><span class="p">(</span><span class="s">&quot;restore-cursor&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_restore_cursor</span><span class="p">)</span>
        <span class="n">events</span><span class="o">.</span><span class="n">add_event_listener</span><span class="p">(</span><span class="s">&quot;cursor-up&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cursor_up</span><span class="p">)</span>
        <span class="n">events</span><span class="o">.</span><span class="n">add_event_listener</span><span class="p">(</span><span class="s">&quot;cursor-down&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cursor_down</span><span class="p">)</span>
        <span class="n">events</span><span class="o">.</span><span class="n">add_event_listener</span><span class="p">(</span><span class="s">&quot;cursor-right&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cursor_forward</span><span class="p">)</span>
        <span class="n">events</span><span class="o">.</span><span class="n">add_event_listener</span><span class="p">(</span><span class="s">&quot;cursor-left&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cursor_back</span><span class="p">)</span>
        <span class="n">events</span><span class="o">.</span><span class="n">add_event_listener</span><span class="p">(</span><span class="s">&quot;cursor-move&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cursor_position</span><span class="p">)</span>
        <span class="n">events</span><span class="o">.</span><span class="n">add_event_listener</span><span class="p">(</span><span class="s">&quot;erase-in-line&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_erase_in_line</span><span class="p">)</span>
        <span class="n">events</span><span class="o">.</span><span class="n">add_event_listener</span><span class="p">(</span><span class="s">&quot;erase-in-display&quot;</span><span class="p">,</span> 
                                  <span class="bp">self</span><span class="o">.</span><span class="n">_erase_in_display</span><span class="p">)</span>
        <span class="n">events</span><span class="o">.</span><span class="n">add_event_listener</span><span class="p">(</span><span class="s">&quot;delete-characters&quot;</span><span class="p">,</span> 
                                  <span class="bp">self</span><span class="o">.</span><span class="n">_delete_character</span><span class="p">)</span>
        <span class="n">events</span><span class="o">.</span><span class="n">add_event_listener</span><span class="p">(</span><span class="s">&quot;insert-lines&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_insert_line</span><span class="p">)</span>
        <span class="n">events</span><span class="o">.</span><span class="n">add_event_listener</span><span class="p">(</span><span class="s">&quot;delete-lines&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delete_line</span><span class="p">)</span>
        <span class="n">events</span><span class="o">.</span><span class="n">add_event_listener</span><span class="p">(</span><span class="s">&quot;select-graphic-rendition&quot;</span><span class="p">,</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">_select_graphic_rendition</span><span class="p">)</span>
        <span class="n">events</span><span class="o">.</span><span class="n">add_event_listener</span><span class="p">(</span><span class="s">&quot;charset-g0&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_charset_g0</span><span class="p">)</span>
        <span class="n">events</span><span class="o">.</span><span class="n">add_event_listener</span><span class="p">(</span><span class="s">&quot;charset-g1&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_charset_g1</span><span class="p">)</span>
        <span class="n">events</span><span class="o">.</span><span class="n">add_event_listener</span><span class="p">(</span><span class="s">&quot;shift-in&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shift_in</span><span class="p">)</span>
        <span class="n">events</span><span class="o">.</span><span class="n">add_event_listener</span><span class="p">(</span><span class="s">&quot;shift-out&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shift_out</span><span class="p">)</span>
        <span class="n">events</span><span class="o">.</span><span class="n">add_event_listener</span><span class="p">(</span><span class="s">&quot;bell&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bell</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="vt102.screen.cursor">
    <p>def <span class="ident">cursor</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>The current location of the cursor.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-vt102.screen.cursor', this);">Show source &equiv;</a></p>
  <div id="source-vt102.screen.cursor" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">cursor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The current location of the cursor.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="vt102.screen.resize">
    <p>def <span class="ident">resize</span>(</p><p>self, shape)</p>
    </div>
    

    
  
    <div class="desc"><p>Resize the screen. If the requested screen size has more rows than the
existing screen, rows will be added at the bottom. If the requested
size has less rows than the existing screen rows will be clipped at the
top of the screen.</p>
<p>Similarly if the existing screen has less columns than the requested 
size, columns will be added at the right, and it it has more, columns 
will be clipped at the right.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-vt102.screen.resize', this);">Show source &equiv;</a></p>
  <div id="source-vt102.screen.resize" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">resize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shape</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Resize the screen. If the requested screen size has more rows than the</span>
<span class="sd">    existing screen, rows will be added at the bottom. If the requested</span>
<span class="sd">    size has less rows than the existing screen rows will be clipped at the</span>
<span class="sd">    top of the screen.</span>
<span class="sd">    Similarly if the existing screen has less columns than the requested </span>
<span class="sd">    size, columns will be added at the right, and it it has more, columns </span>
<span class="sd">    will be clipped at the right.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rows</span><span class="p">,</span> <span class="n">cols</span> <span class="o">=</span> <span class="n">shape</span>
    <span class="c"># Honestly though, you can&#39;t trust anyone these days...</span>
    <span class="k">assert</span><span class="p">(</span><span class="n">rows</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">cols</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
    <span class="c"># First resize the rows</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">rows</span><span class="p">:</span>
        <span class="c"># If the current display size is shorter than the requested screen</span>
        <span class="c"># size, then add rows to the bottom. Note that the old column size</span>
        <span class="c"># is used here so these new rows will get expanded/contracted as</span>
        <span class="c"># necessary by the column resize when it happens next.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span> <span class="o">+=</span> <span class="p">[</span><span class="s">u&quot; &quot;</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">*</span> <span class="p">(</span><span class="n">rows</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span> <span class="o">+=</span> <span class="p">[[</span><span class="bp">self</span><span class="o">.</span><span class="n">default_attributes</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">*</span> \
                <span class="p">(</span><span class="n">rows</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">rows</span><span class="p">:</span>
        <span class="c"># If the current display size is taller than the requested display,</span>
        <span class="c"># then take rows off the top.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">rows</span><span class="p">:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">rows</span><span class="p">:]</span>
    <span class="c"># Next, of course, resize the columns.</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">cols</span><span class="p">:</span>
        <span class="c"># If the current display size is thinner than the requested size,</span>
        <span class="c"># expand each row to be the new size.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span> <span class="o">=</span> \
            <span class="p">[</span><span class="n">row</span> <span class="o">+</span> <span class="p">(</span><span class="s">u&quot; &quot;</span> <span class="o">*</span> <span class="p">(</span><span class="n">cols</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span> <span class="o">=</span> \
            <span class="p">[</span><span class="n">row</span> <span class="o">+</span> <span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">default_attributes</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">cols</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">]</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">cols</span><span class="p">:</span>
        <span class="c"># If the current display size is fatter than the requested size,</span>
        <span class="c"># then trim each row from the right to be the new size.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[:</span><span class="n">cols</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[:</span><span class="n">cols</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span>
</pre></div>

  </div>
</div>

  </div>
  
          <h3>Instance variables</h3>
            <div class="item">
            <p id="vt102.screen.attributes" class="name">var <span class="ident">attributes</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="vt102.screen.current_charset" class="name">var <span class="ident">current_charset</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="vt102.screen.cursor_attributes" class="name">var <span class="ident">cursor_attributes</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="vt102.screen.cursor_save_stack" class="name">var <span class="ident">cursor_save_stack</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="vt102.screen.decoder" class="name">var <span class="ident">decoder</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="vt102.screen.display" class="name">var <span class="ident">display</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="vt102.screen.encoding" class="name">var <span class="ident">encoding</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="vt102.screen.g0" class="name">var <span class="ident">g0</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="vt102.screen.g1" class="name">var <span class="ident">g1</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="vt102.screen.irm" class="name">var <span class="ident">irm</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="vt102.screen.size" class="name">var <span class="ident">size</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="vt102.screen.tabstops" class="name">var <span class="ident">tabstops</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="vt102.screen.x" class="name">var <span class="ident">x</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="vt102.screen.y" class="name">var <span class="ident">y</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
      </div>
      </div>
      
      <div class="item">
      <p id="vt102.stream" class="name">class <span class="ident">stream</span></p>
      
  
    <div class="desc"><p>A stream is the state machine that parses a stream of terminal characters
and dispatches events based on what it sees. This can be attached to a 
screen object and it's events, or can be used some other way.</p>
<p><code>stream.basic</code>, <code>stream.escape</code>, and <code>stream.sequence</code> are the relevant 
events that get thrown with one addition: <code>print</code>. For details on the
event parameters, see the <a href="http://vt100.net/docs/vt102-ug/">vt102 user's
guide</a></p>
<p>Quick example:</p>
<div class="codehilite"><pre>&gt;&gt;&gt; s = stream()
&gt;&gt;&gt; class Cursor:
...     def __init__(self):
...         self.x = 10; self.y = 10
...     def up(self, count):
...         self.y -= count
...
&gt;&gt;&gt; c = Cursor()
&gt;&gt;&gt; s.add_event_listener(&quot;cursor-up&quot;, c.up)
&gt;&gt;&gt; s.process(u&quot;\x00\x1b[5A&quot;) # Move the cursor up 5 rows.
&gt;&gt;&gt; print(c.y)
5
</pre></div></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-vt102.stream', this);">Show source &equiv;</a></p>
  <div id="source-vt102.stream" class="source">
    <div class="codehilite"><pre><span class="k">class</span> <span class="nc">stream</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A stream is the state machine that parses a stream of terminal characters</span>
<span class="sd">    and dispatches events based on what it sees. This can be attached to a </span>
<span class="sd">    screen object and it&#39;s events, or can be used some other way.</span>

<span class="sd">    `stream.basic`, `stream.escape`, and `stream.sequence` are the relevant </span>
<span class="sd">    events that get thrown with one addition: `print`. For details on the</span>
<span class="sd">    event parameters, see the [vt102 user&#39;s</span>
<span class="sd">    guide](http://vt100.net/docs/vt102-ug/)</span>

<span class="sd">    Quick example:</span>

<span class="sd">        &gt;&gt;&gt; s = stream()</span>
<span class="sd">        &gt;&gt;&gt; class Cursor:</span>
<span class="sd">        ...     def __init__(self):</span>
<span class="sd">        ...         self.x = 10; self.y = 10</span>
<span class="sd">        ...     def up(self, count):</span>
<span class="sd">        ...         self.y -= count</span>
<span class="sd">        ...</span>
<span class="sd">        &gt;&gt;&gt; c = Cursor()</span>
<span class="sd">        &gt;&gt;&gt; s.add_event_listener(&quot;cursor-up&quot;, c.up)</span>
<span class="sd">        &gt;&gt;&gt; s.process(u&quot;\\x00\\x1b[5A&quot;) # Move the cursor up 5 rows.</span>
<span class="sd">        &gt;&gt;&gt; print(c.y)</span>
<span class="sd">        5</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">basic</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">ctrl</span><span class="o">.</span><span class="n">BS</span><span class="p">:</span> <span class="s">&quot;backspace&quot;</span><span class="p">,</span>
        <span class="n">ctrl</span><span class="o">.</span><span class="n">HT</span><span class="p">:</span> <span class="s">&quot;tab&quot;</span><span class="p">,</span>
        <span class="n">ctrl</span><span class="o">.</span><span class="n">LF</span><span class="p">:</span> <span class="s">&quot;linefeed&quot;</span><span class="p">,</span>
        <span class="n">ctrl</span><span class="o">.</span><span class="n">VT</span><span class="p">:</span> <span class="s">&quot;linefeed&quot;</span><span class="p">,</span>
        <span class="n">ctrl</span><span class="o">.</span><span class="n">FF</span><span class="p">:</span> <span class="s">&quot;linefeed&quot;</span><span class="p">,</span>
        <span class="n">ctrl</span><span class="o">.</span><span class="n">CR</span><span class="p">:</span> <span class="s">&quot;carriage-return&quot;</span><span class="p">,</span>
        <span class="n">ctrl</span><span class="o">.</span><span class="n">SI</span><span class="p">:</span> <span class="s">&quot;shift-in&quot;</span><span class="p">,</span>
        <span class="n">ctrl</span><span class="o">.</span><span class="n">SO</span><span class="p">:</span> <span class="s">&quot;shift-out&quot;</span><span class="p">,</span>
        <span class="n">ctrl</span><span class="o">.</span><span class="n">BEL</span><span class="p">:</span> <span class="s">&quot;bell&quot;</span>
    <span class="p">}</span>

    <span class="n">escape</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">esc</span><span class="o">.</span><span class="n">IND</span><span class="p">:</span> <span class="s">&quot;index&quot;</span><span class="p">,</span>
        <span class="n">esc</span><span class="o">.</span><span class="n">RI</span><span class="p">:</span> <span class="s">&quot;reverse-index&quot;</span><span class="p">,</span>
        <span class="n">esc</span><span class="o">.</span><span class="n">NEL</span><span class="p">:</span> <span class="s">&quot;linefeed&quot;</span><span class="p">,</span>
        <span class="n">esc</span><span class="o">.</span><span class="n">DECSC</span><span class="p">:</span> <span class="s">&quot;store-cursor&quot;</span><span class="p">,</span>
        <span class="n">esc</span><span class="o">.</span><span class="n">DECRC</span><span class="p">:</span> <span class="s">&quot;restore-cursor&quot;</span><span class="p">,</span>
        <span class="n">esc</span><span class="o">.</span><span class="n">RLF</span><span class="p">:</span> <span class="s">&quot;reverse-linefeed&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">sequence</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">esc</span><span class="o">.</span><span class="n">CUU</span><span class="p">:</span> <span class="s">&quot;cursor-up&quot;</span><span class="p">,</span>
        <span class="n">esc</span><span class="o">.</span><span class="n">CUD</span><span class="p">:</span> <span class="s">&quot;cursor-down&quot;</span><span class="p">,</span>
        <span class="n">esc</span><span class="o">.</span><span class="n">CUF</span><span class="p">:</span> <span class="s">&quot;cursor-right&quot;</span><span class="p">,</span>
        <span class="n">esc</span><span class="o">.</span><span class="n">CUB</span><span class="p">:</span> <span class="s">&quot;cursor-left&quot;</span><span class="p">,</span>
        <span class="n">esc</span><span class="o">.</span><span class="n">CUP</span><span class="p">:</span> <span class="s">&quot;cursor-move&quot;</span><span class="p">,</span>
        <span class="n">esc</span><span class="o">.</span><span class="n">HVP</span><span class="p">:</span> <span class="s">&quot;cursor-move&quot;</span><span class="p">,</span>
        <span class="n">esc</span><span class="o">.</span><span class="n">EL</span><span class="p">:</span> <span class="s">&quot;erase-in-line&quot;</span><span class="p">,</span>
        <span class="n">esc</span><span class="o">.</span><span class="n">ED</span><span class="p">:</span> <span class="s">&quot;erase-in-display&quot;</span><span class="p">,</span>
        <span class="n">esc</span><span class="o">.</span><span class="n">DCH</span><span class="p">:</span> <span class="s">&quot;delete-characters&quot;</span><span class="p">,</span>
        <span class="n">esc</span><span class="o">.</span><span class="n">IL</span><span class="p">:</span> <span class="s">&quot;insert-lines&quot;</span><span class="p">,</span>
        <span class="n">esc</span><span class="o">.</span><span class="n">DL</span><span class="p">:</span> <span class="s">&quot;delete-lines&quot;</span><span class="p">,</span>
        <span class="n">esc</span><span class="o">.</span><span class="n">SGR</span><span class="p">:</span> <span class="s">&quot;select-graphic-rendition&quot;</span><span class="p">,</span>
        <span class="n">esc</span><span class="o">.</span><span class="n">DECSTBM</span><span class="p">:</span> <span class="s">&quot;set-margins&quot;</span><span class="p">,</span>
        <span class="n">esc</span><span class="o">.</span><span class="n">IRMI</span><span class="p">:</span> <span class="s">&quot;set-insert&quot;</span><span class="p">,</span>
        <span class="n">esc</span><span class="o">.</span><span class="n">IRMR</span><span class="p">:</span> <span class="s">&quot;set-replace&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fail_on_unknown_esc</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s">&quot;stream&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_param</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">listeners</span> <span class="o">=</span> <span class="p">{}</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">fail_on_unknown_esc</span> <span class="o">=</span> <span class="n">fail_on_unknown_esc</span>

    <span class="k">def</span> <span class="nf">_escape_sequence</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">char</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handle characters seen when in an escape sequence. Most non-vt52</span>
<span class="sd">        commands start with a left-bracket after the escape and then a </span>
<span class="sd">        stream of parameters and a command.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">num</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">char</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">char</span> <span class="o">==</span> <span class="s">&quot;[&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s">&quot;escape-lb&quot;</span>
        <span class="k">elif</span> <span class="n">char</span> <span class="o">==</span> <span class="s">&quot;(&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s">&quot;charset-g0&quot;</span>
        <span class="k">elif</span> <span class="n">char</span> <span class="o">==</span> <span class="s">&quot;)&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s">&quot;charset-g1&quot;</span>
        <span class="k">elif</span> <span class="n">num</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">escape</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dispatch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">escape</span><span class="p">[</span><span class="n">num</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s">&quot;stream&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">fail_on_unknown_esc</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">StreamProcessError</span><span class="p">(</span><span class="s">&quot;Unexpected character &#39;</span><span class="si">%c</span><span class="s">&#39; == &#39;0x</span><span class="si">%02x</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">char</span><span class="p">,</span> <span class="nb">ord</span><span class="p">(</span><span class="n">char</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">_end_escape_sequence</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">char</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handle the end of an escape sequence. The final character in an escape</span>
<span class="sd">        sequence is the command to execute, which corresponds to the event that</span>
<span class="sd">        is dispatched here.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">num</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">char</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">num</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sequence</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dispatch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sequence</span><span class="p">[</span><span class="n">num</span><span class="p">],</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s">&quot;stream&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_param</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">_escape_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">char</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parse parameters in an escape sequence. Parameters are a list of</span>
<span class="sd">        numbers in ascii (e.g. &#39;12&#39;, &#39;4&#39;, &#39;42&#39;, etc) separated by a semicolon</span>
<span class="sd">        (e.g. &quot;12;4;42&quot;).</span>
<span class="sd">        </span>
<span class="sd">        See the [vt102 user guide](http://vt100.net/docs/vt102-ug/) for more</span>
<span class="sd">        details on the formatting of escape parameters. </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">char</span> <span class="o">==</span> <span class="s">&quot;;&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_param</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_param</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="k">elif</span> <span class="n">char</span> <span class="o">==</span> <span class="s">&quot;?&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s">&quot;mode&quot;</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">char</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_param</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_param</span><span class="p">))</span>

            <span class="c"># If we&#39;re in parameter parsing mode, but we see a non-numeric </span>
            <span class="c"># value, it must be the end of the control sequence.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_end_escape_sequence</span><span class="p">(</span><span class="n">char</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_param</span> <span class="o">+=</span> <span class="n">char</span>

    <span class="k">def</span> <span class="nf">_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">char</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">char</span> <span class="ow">in</span> <span class="s">&quot;lh&quot;</span><span class="p">:</span>
            <span class="c"># &#39;l&#39; or &#39;h&#39; designates the end of a mode stream. We don&#39;t</span>
            <span class="c"># really care about mode streams so anything else seen while</span>
            <span class="c"># in the mode state, is just ignored.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s">&quot;stream&quot;</span>

    <span class="k">def</span> <span class="nf">_charset_g0</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">char</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dispatch</span><span class="p">(</span><span class="s">&quot;charset-g0&quot;</span><span class="p">,</span> <span class="n">char</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s">&quot;stream&quot;</span>

    <span class="k">def</span> <span class="nf">_charset_g1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">char</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dispatch</span><span class="p">(</span><span class="s">&quot;charset-g1&quot;</span><span class="p">,</span> <span class="n">char</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s">&quot;stream&quot;</span>

    <span class="k">def</span> <span class="nf">_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">char</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Process a character when in the</span>
<span class="sd">        default &#39;stream&#39; state.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">num</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">char</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">num</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">basic</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dispatch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">basic</span><span class="p">[</span><span class="n">num</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">num</span> <span class="o">==</span> <span class="n">ctrl</span><span class="o">.</span><span class="n">ESC</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s">&quot;escape&quot;</span>
        <span class="k">elif</span> <span class="n">num</span> <span class="o">==</span> <span class="mh">0x00</span><span class="p">:</span>
            <span class="c"># nulls are just ignored.</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">dispatch</span><span class="p">(</span><span class="s">&quot;print&quot;</span><span class="p">,</span> <span class="n">char</span><span class="p">)</span> 

    <span class="k">def</span> <span class="nf">consume</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">char</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Consume a single character and advance the state as necessary.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s">&quot;stream&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_stream</span><span class="p">(</span><span class="n">char</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s">&quot;escape&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_escape_sequence</span><span class="p">(</span><span class="n">char</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s">&quot;escape-lb&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_escape_parameters</span><span class="p">(</span><span class="n">char</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s">&quot;mode&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span><span class="p">(</span><span class="n">char</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s">&quot;charset-g0&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_charset_g0</span><span class="p">(</span><span class="n">char</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s">&quot;charset-g1&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_charset_g1</span><span class="p">(</span><span class="n">char</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chars</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Consume a string of  and advance the state as necessary.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">chars</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">consume</span><span class="p">(</span><span class="n">chars</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">chars</span> <span class="o">=</span> <span class="n">chars</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

    <span class="k">def</span> <span class="nf">add_event_listener</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">function</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add an event listen for a particular event. Depending on the event</span>
<span class="sd">        there may or may not be parameters passed to function. Most escape </span>
<span class="sd">        streams also allow for an empty set of parameters (with a default</span>
<span class="sd">        value). Providing these default values and accepting variable arguments</span>
<span class="sd">        is the responsibility of function.</span>

<span class="sd">        More than one listener may be added for a single event. Each listener</span>
<span class="sd">        will be called.</span>
<span class="sd">        </span>
<span class="sd">        * **event** The event to listen for.</span>
<span class="sd">        * **function** The callable to invoke.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">event</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">listeners</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">listeners</span><span class="p">[</span><span class="n">event</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">listeners</span><span class="p">[</span><span class="n">event</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">function</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">dispatch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dispatch an event where `args` is a tuple of the arguments to send to </span>
<span class="sd">        any callbacks. If any callback throws an exception, the subsequent </span>
<span class="sd">        callbacks will be aborted.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">callback</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">listeners</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="p">[]):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">callback</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">callback</span><span class="p">()</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#vt102.stream">stream</a></li>
          <li>builtins.object</li>
          </ul>
          <h3>Class variables</h3>
            <div class="item">
            <p id="vt102.stream.basic" class="name">var <span class="ident">basic</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="vt102.stream.escape" class="name">var <span class="ident">escape</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="vt102.stream.sequence" class="name">var <span class="ident">sequence</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
          <h3>Static methods</h3>
            
  <div class="item">
    <div class="name def" id="vt102.stream.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, fail_on_unknown_esc=True)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-vt102.stream.__init__', this);">Show source &equiv;</a></p>
  <div id="source-vt102.stream.__init__" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fail_on_unknown_esc</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s">&quot;stream&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">current_param</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">listeners</span> <span class="o">=</span> <span class="p">{}</span> 
    <span class="bp">self</span><span class="o">.</span><span class="n">fail_on_unknown_esc</span> <span class="o">=</span> <span class="n">fail_on_unknown_esc</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="vt102.stream.add_event_listener">
    <p>def <span class="ident">add_event_listener</span>(</p><p>self, event, function)</p>
    </div>
    

    
  
    <div class="desc"><p>Add an event listen for a particular event. Depending on the event
there may or may not be parameters passed to function. Most escape 
streams also allow for an empty set of parameters (with a default
value). Providing these default values and accepting variable arguments
is the responsibility of function.</p>
<p>More than one listener may be added for a single event. Each listener
will be called.</p>
<ul>
<li><strong>event</strong> The event to listen for.</li>
<li><strong>function</strong> The callable to invoke.</li>
</ul></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-vt102.stream.add_event_listener', this);">Show source &equiv;</a></p>
  <div id="source-vt102.stream.add_event_listener" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">add_event_listener</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">function</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add an event listen for a particular event. Depending on the event</span>
<span class="sd">    there may or may not be parameters passed to function. Most escape </span>
<span class="sd">    streams also allow for an empty set of parameters (with a default</span>
<span class="sd">    value). Providing these default values and accepting variable arguments</span>
<span class="sd">    is the responsibility of function.</span>
<span class="sd">    More than one listener may be added for a single event. Each listener</span>
<span class="sd">    will be called.</span>
<span class="sd">    </span>
<span class="sd">    * **event** The event to listen for.</span>
<span class="sd">    * **function** The callable to invoke.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">event</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">listeners</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">listeners</span><span class="p">[</span><span class="n">event</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">listeners</span><span class="p">[</span><span class="n">event</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">function</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="vt102.stream.consume">
    <p>def <span class="ident">consume</span>(</p><p>self, char)</p>
    </div>
    

    
  
    <div class="desc"><p>Consume a single character and advance the state as necessary.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-vt102.stream.consume', this);">Show source &equiv;</a></p>
  <div id="source-vt102.stream.consume" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">consume</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">char</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Consume a single character and advance the state as necessary.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s">&quot;stream&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_stream</span><span class="p">(</span><span class="n">char</span><span class="p">)</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s">&quot;escape&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_escape_sequence</span><span class="p">(</span><span class="n">char</span><span class="p">)</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s">&quot;escape-lb&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_escape_parameters</span><span class="p">(</span><span class="n">char</span><span class="p">)</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s">&quot;mode&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span><span class="p">(</span><span class="n">char</span><span class="p">)</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s">&quot;charset-g0&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_charset_g0</span><span class="p">(</span><span class="n">char</span><span class="p">)</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s">&quot;charset-g1&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_charset_g1</span><span class="p">(</span><span class="n">char</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="vt102.stream.dispatch">
    <p>def <span class="ident">dispatch</span>(</p><p>self, event, *args)</p>
    </div>
    

    
  
    <div class="desc"><p>Dispatch an event where <code>args</code> is a tuple of the arguments to send to 
any callbacks. If any callback throws an exception, the subsequent 
callbacks will be aborted.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-vt102.stream.dispatch', this);">Show source &equiv;</a></p>
  <div id="source-vt102.stream.dispatch" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">dispatch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Dispatch an event where `args` is a tuple of the arguments to send to </span>
<span class="sd">    any callbacks. If any callback throws an exception, the subsequent </span>
<span class="sd">    callbacks will be aborted.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">callback</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">listeners</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="p">[]):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">callback</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">callback</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="vt102.stream.process">
    <p>def <span class="ident">process</span>(</p><p>self, chars)</p>
    </div>
    

    
  
    <div class="desc"><p>Consume a string of  and advance the state as necessary.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-vt102.stream.process', this);">Show source &equiv;</a></p>
  <div id="source-vt102.stream.process" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chars</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Consume a string of  and advance the state as necessary.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">chars</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">consume</span><span class="p">(</span><span class="n">chars</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">chars</span> <span class="o">=</span> <span class="n">chars</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
</pre></div>

  </div>
</div>

  </div>
  
          <h3>Instance variables</h3>
            <div class="item">
            <p id="vt102.stream.current_param" class="name">var <span class="ident">current_param</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="vt102.stream.fail_on_unknown_esc" class="name">var <span class="ident">fail_on_unknown_esc</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="vt102.stream.listeners" class="name">var <span class="ident">listeners</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="vt102.stream.params" class="name">var <span class="ident">params</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="vt102.stream.state" class="name">var <span class="ident">state</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
      </div>
      </div>

  </section>

    </article>
  <div class="clear"> </div>
  <footer id="footer">
    <p>
      Documentation generated by
      <a href="https://github.com/BurntSushi/pdoc">pdoc 0.3.1</a>
    </p>

    <p>pdoc is in the public domain with the
      <a href="http://unlicense.org">UNLICENSE</a></p>

    <p>Design by <a href="http://nadh.in">Kailash Nadh</a></p>
  </footer>
</div>
</body>
</html>
